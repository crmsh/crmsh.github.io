<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 10.2.0">
<title>crmsh - crm(8)</title>
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/crm.css" type="text/css">
<link href='//fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="crmsh atom feed">
</head>
<body>
<div id="header">
<h1>
<a href="/"><span class="fa-stack">
  <i class="fa fa-square fa-stack-2x"></i>
  <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
</span>crmsh</a>
</h1>

<div id="topbar-small">
<ul>
<li><a href="/news" title="News"><i class="fa fa-rss fa-2x"></i></a></li>
<li><a href="/documentation" title="Documentation"><i class="fa fa-book fa-2x"></i></a></li>
<li><a href="/download" title="Download"><i class="fa fa-download fa-2x"></i></a></li>
<li><a href="/development" title="Development"><i class="fa fa-code-fork fa-2x"></i></a></li>
<li><a href="/about" title="About"><i class="fa fa-question fa-2x"></i></a></li>
</ul>
</div>

<div id="topbar">
<ul>
<li><a href="/news">News</a></li>
<li><a href="/documentation">Documentation</a></li>
<li><a href="/download">Download</a></li>
<li><a href="/development">Development</a></li>
<li><a href="/about">About</a></li>
</ul>
</div>
</div>
<!--TOC-->
<div id="toc">
<div class="toclevel1"><a href="#topics_Description">Program description</a></div>
<div class="toclevel1"><a href="#topics_CommandLine">Command line options</a></div>
<div class="toclevel1"><a href="#topics_Introduction">Introduction</a></div>
<div class="toclevel2"><a href="#topics_Introduction_Interface">User interface</a></div>
<div class="toclevel2"><a href="#topics_Introduction_Completion">Tab completion</a></div>
<div class="toclevel2"><a href="#topics_Introduction_Shorthand">Shorthand syntax</a></div>
<div class="toclevel1"><a href="#topics_Features">Features</a></div>
<div class="toclevel2"><a href="#topics_Features_Shadows">Shadow CIB usage</a></div>
<div class="toclevel2"><a href="#topics_Features_Checks">Configuration semantic checks</a></div>
<div class="toclevel2"><a href="#topics_Features_Templates">Configuration templates</a></div>
<div class="toclevel2"><a href="#topics_Features_Testing">Resource testing</a></div>
<div class="toclevel2"><a href="#topics_Features_Security">Access Control Lists (ACL)</a></div>
<div class="toclevel2"><a href="#topics_Features_Resourcesets">Syntax: Resource sets</a></div>
<div class="toclevel2"><a href="#topics_Features_AttributeListReferences">Syntax: Attribute list references</a></div>
<div class="toclevel2"><a href="#topics_Features_AttributeReferences">Syntax: Attribute references</a></div>
<div class="toclevel2"><a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a></div>
<div class="toclevel1"><a href="#topics_Reference">Command reference</a></div>
<div class="toclevel3"><a href="#cmdhelp_root_status">status</a></div>
<div class="toclevel3"><a href="#cmdhelp_root_verify">verify</a></div>
<div class="toclevel2"><a href="#cmdhelp_cluster">cluster</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_add">add</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_copy">copy</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_diff">diff</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_geo_init">geo_init</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_geo_init_arbitrator">geo_init_arbitrator</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_geo_join">geo_join</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_health">health</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_init">init</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_join">join</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_remove">remove</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_run">run</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_start">start</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_status">status</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_stop">stop</a></div>
<div class="toclevel3"><a href="#cmdhelp_cluster_wait_for_startup">wait_for_startup</a></div>
<div class="toclevel2"><a href="#cmdhelp_script">script</a></div>
<div class="toclevel3"><a href="#cmdhelp_script_json">json</a></div>
<div class="toclevel3"><a href="#cmdhelp_script_list">list</a></div>
<div class="toclevel3"><a href="#cmdhelp_script_run">run</a></div>
<div class="toclevel3"><a href="#cmdhelp_script_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_script_verify">verify</a></div>
<div class="toclevel2"><a href="#cmdhelp_corosync">corosync</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_add-node">add-node</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_del-node">del-node</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_diff">diff</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_edit">edit</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_get">get</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_log">log</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_pull">pull</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_push">push</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_reload">reload</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_set">set</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_corosync_status">status</a></div>
<div class="toclevel2"><a href="#cmdhelp_cib">cib</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_cibstatus">cibstatus</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_commit">commit</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_delete">delete</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_diff">diff</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_import">import</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_list">list</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_new">new</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_reset">reset</a></div>
<div class="toclevel3"><a href="#cmdhelp_cib_use">use</a></div>
<div class="toclevel2"><a href="#cmdhelp_ra">ra</a></div>
<div class="toclevel3"><a href="#cmdhelp_ra_classes">classes</a></div>
<div class="toclevel3"><a href="#cmdhelp_ra_info">info</a></div>
<div class="toclevel3"><a href="#cmdhelp_ra_list">list</a></div>
<div class="toclevel3"><a href="#cmdhelp_ra_providers">providers</a></div>
<div class="toclevel3"><a href="#cmdhelp_ra_validate">validate</a></div>
<div class="toclevel2"><a href="#cmdhelp_resource">resource</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_ban">ban</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_cleanup">cleanup</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_clear">clear</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_constraints">constraints</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_demote">demote</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_failcount">failcount</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_locate">locate</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_maintenance">maintenance</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_manage">manage</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_meta">meta</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_move">move</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_operations">operations</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_param">param</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_promote">promote</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_refresh">refresh</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_reprobe">reprobe</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_restart">restart</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_scores">scores</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_secret">secret</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_start">start</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_status">status</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_stop">stop</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_trace">trace</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_unmanage">unmanage</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_untrace">untrace</a></div>
<div class="toclevel3"><a href="#cmdhelp_resource_utilization">utilization</a></div>
<div class="toclevel2"><a href="#cmdhelp_node">node</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_attribute">attribute</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_clearstate">clearstate</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_delete">delete</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_fence">fence</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_maintenance">maintenance</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_online">online</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_ready">ready</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_server">server</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_standby">standby</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_status">status</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_status-attr">status-attr</a></div>
<div class="toclevel3"><a href="#cmdhelp_node_utilization">utilization</a></div>
<div class="toclevel2"><a href="#cmdhelp_site">site</a></div>
<div class="toclevel3"><a href="#cmdhelp_site_ticket">ticket</a></div>
<div class="toclevel2"><a href="#cmdhelp_options">options</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_add-quotes">add-quotes</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_check-frequency">check-frequency</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_check-mode">check-mode</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_colorscheme">colorscheme</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_editor">editor</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_manage-children">manage-children</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_output">output</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_pager">pager</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_reset">reset</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_save">save</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_set">set</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_skill-level">skill-level</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_sort-elements">sort-elements</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_user">user</a></div>
<div class="toclevel3"><a href="#cmdhelp_options_wait">wait</a></div>
<div class="toclevel2"><a href="#cmdhelp_configure">configure</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_acl_target">acl_target</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_alert">alert</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_cib">cib</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_cibstatus">cibstatus</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_clone">clone</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_colocation">colocation</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_commit">commit</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_default-timeouts">default-timeouts</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_delete">delete</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_edit">edit</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_erase">erase</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_fencing_topology">fencing_topology</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_filter">filter</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_get_property">get_property</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_graph">graph</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_group">group</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_load">load</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_location">location</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_modgroup">modgroup</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_monitor">monitor</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_ms">ms</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_node">node</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_op_defaults">op_defaults</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_order">order</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_primitive">primitive</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_property">property</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_ptest">ptest</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_refresh">refresh</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_rename">rename</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_role">role</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_rsc_defaults">rsc_defaults</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_rsc_template">rsc_template</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_rsc_ticket">rsc_ticket</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_rsctest">rsctest</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_save">save</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_schema">schema</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_set">set</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_tag">tag</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_template">template</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_upgrade">upgrade</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_user">user</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_validate_all">validate_all</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_verify">verify</a></div>
<div class="toclevel3"><a href="#cmdhelp_configure_xml">xml</a></div>
<div class="toclevel2"><a href="#cmdhelp_template">template</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_apply">apply</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_delete">delete</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_edit">edit</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_list">list</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_load">load</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_new">new</a></div>
<div class="toclevel3"><a href="#cmdhelp_template_show">show</a></div>
<div class="toclevel2"><a href="#cmdhelp_cibstatus">cibstatus</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_load">load</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_node">node</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_op">op</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_origin">origin</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_quorum">quorum</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_run">run</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_save">save</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_simulate">simulate</a></div>
<div class="toclevel3"><a href="#cmdhelp_cibstatus_ticket">ticket</a></div>
<div class="toclevel2"><a href="#cmdhelp_assist">assist</a></div>
<div class="toclevel3"><a href="#cmdhelp_assist_template">template</a></div>
<div class="toclevel3"><a href="#cmdhelp_assist_weak-bond">weak-bond</a></div>
<div class="toclevel2"><a href="#cmdhelp_maintenance">maintenance</a></div>
<div class="toclevel3"><a href="#cmdhelp_maintenance_action">action</a></div>
<div class="toclevel3"><a href="#cmdhelp_maintenance_off">off</a></div>
<div class="toclevel3"><a href="#cmdhelp_maintenance_on">on</a></div>
<div class="toclevel2"><a href="#cmdhelp_history">history</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_detail">detail</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_diff">diff</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_events">events</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_exclude">exclude</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_graph">graph</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_info">info</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_latest">latest</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_limit">limit</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_log">log</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_node">node</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_peinputs">peinputs</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_refresh">refresh</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_resource">resource</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_session">session</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_setnodes">setnodes</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_show">show</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_source">source</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_transition">transition</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_transitions">transitions</a></div>
<div class="toclevel3"><a href="#cmdhelp_history_wdiff">wdiff</a></div>
<div class="toclevel3"><a href="#cmdhelp_root_report">report</a></div>
</div>
<div id="container">
<div id="content">
<h1>crm(8)</h1>
<div class="sect1">
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<div class="paragraph"><p>crm - Pacemaker command line interface for configuration and management</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>crm</strong> [OPTIONS] [SUBCOMMAND ARGS&#8230;]</p></div>
</div>
</div>
<div class="sect1">
<h2 id="topics_Description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <span class="monospaced">crm</span> shell is a command-line based cluster configuration and
management tool. Its goal is to assist as much as possible with the
configuration and maintenance of Pacemaker-based High Availability
clusters.</p></div>
<div class="paragraph"><p>For more information on Pacemaker itself, see <a href="http://clusterlabs.org/">http://clusterlabs.org/</a>.</p></div>
<div class="paragraph"><p><span class="monospaced">crm</span> works both as a command-line tool to be called directly from the
system shell, and as an interactive shell with extensive tab
completion and help.</p></div>
<div class="paragraph"><p>The primary focus of the <span class="monospaced">crm</span> shell is to provide a simplified and
consistent interface to Pacemaker, but it also provides tools for
managing the creation and configuration of High Availability clusters
from scratch. To learn more about this aspect of <span class="monospaced">crm</span>, see the
<span class="monospaced">cluster</span> section below.</p></div>
<div class="paragraph"><p>The <span class="monospaced">crm</span> shell can be used to manage every aspect of configuring and
maintaining a cluster. It provides a simplified line-based syntax on
top of the XML configuration format used by Pacemaker, commands for
starting and stopping resources, tools for exploring the history of a
cluster including log scraping and a set of cluster scripts useful for
automating the setup and installation of services on the cluster
nodes.</p></div>
<div class="paragraph"><p>The <span class="monospaced">crm</span> shell is line oriented: every command must start and finish
on the same line. It is possible to use a continuation character (<span class="monospaced">\</span>)
to write one command in two or more lines. The continuation character
is commonly used when displaying configurations.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="topics_CommandLine">OPTIONS</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-f, --file</strong>=<em>FILE</em>
</dt>
<dd>
<p>
    Load commands from the given file. If a dash <span class="monospaced">-</span> is used in place
    of a file name, <span class="monospaced">crm</span> will read commands from the shell standard
    input (<span class="monospaced">stdin</span>).
</p>
</dd>
<dt class="hdlist1">
<strong>-c, --cib</strong>=<em>CIB</em>
</dt>
<dd>
<p>
    Start the session using the given shadow CIB file.
    Equivalent to <span class="monospaced">cib use &lt;CIB&gt;</span>.
</p>
</dd>
<dt class="hdlist1">
<strong>-D, --display=</strong><em>OUTPUT_TYPE</em>
</dt>
<dd>
<p>
    Choose one of the output options: <span class="monospaced">plain</span>, <span class="monospaced">color-always</span>, <span class="monospaced">color</span>,
    or <span class="monospaced">uppercase</span>. The default is <span class="monospaced">color</span> if the terminal emulation
    supports colors. Otherwise, <span class="monospaced">plain</span> is used.
</p>
</dd>
<dt class="hdlist1">
<strong>-F, --force</strong>
</dt>
<dd>
<p>
    Make <span class="monospaced">crm</span> proceed with applying changes where it would normally
    ask the user to confirm before proceeding. This option is mainly
    useful in scripts, and should be used with care.
</p>
</dd>
<dt class="hdlist1">
<strong>-w, --wait</strong>
</dt>
<dd>
<p>
    Make <span class="monospaced">crm</span> wait for the cluster transition to finish (for the
    changes to take effect) after each processed line.
</p>
</dd>
<dt class="hdlist1">
<strong>-H, --history</strong>=<em>DIR|FILE|SESSION</em>
</dt>
<dd>
<p>
    A directory or file containing a cluster report to load
    into the <span class="monospaced">history</span> commands, or the name of a previously
    saved history session.
</p>
</dd>
<dt class="hdlist1">
<strong>-h, --help</strong>
</dt>
<dd>
<p>
    Print help page.
</p>
</dd>
<dt class="hdlist1">
<strong>--version</strong>
</dt>
<dd>
<p>
    Print crmsh version and build information (Mercurial Hg changeset
    hash).
</p>
</dd>
<dt class="hdlist1">
<strong>-d, --debug</strong>
</dt>
<dd>
<p>
    Print verbose debugging information.
</p>
</dd>
<dt class="hdlist1">
<strong>-R, --regression-tests</strong>
</dt>
<dd>
<p>
    Enables extra verbose trace logging used by the regression
    tests. Logs all external calls made by crmsh.
</p>
</dd>
<dt class="hdlist1">
<strong>--scriptdir</strong>=<em>DIR</em>
</dt>
<dd>
<p>
    Extra directory where crm looks for cluster scripts, or a list of
    directories separated by semi-colons (e.g. <span class="monospaced">/dir1;/dir2;etc.</span>).
</p>
</dd>
<dt class="hdlist1">
<strong>-o, --opt</strong>=<em>OPTION=VALUE</em>
</dt>
<dd>
<p>
     Set crmsh option temporarily. If the options are saved using
     <span class="monospaced">options save</span> then the value passed here will also be saved.
     Multiple options can be set by using <span class="monospaced">-o</span> multiple times.
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="topics_Introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section of the user guide covers general topics about the user
interface and describes some of the features of <span class="monospaced">crmsh</span> in detail.</p></div>
<div class="sect2">
<h3 id="topics_Introduction_Interface">User interface</h3>
<div class="paragraph"><p>The main purpose of <span class="monospaced">crmsh</span> is to provide a simple yet powerful
interface to the cluster stack. There are two main modes of operation
with the user interface of <span class="monospaced">crmsh</span>:</p></div>
<div class="ulist"><ul>
<li>
<p>
Command line (single-shot) use - Use <span class="monospaced">crm</span> as a regular UNIX command
  from your usual shell. <span class="monospaced">crm</span> has full bash completion built in, so
  using it in this manner should be as comfortable and familiar as
  using any other command-line tool.
</p>
</li>
<li>
<p>
Interactive mode - By calling <span class="monospaced">crm</span> without arguments, or by calling
  it with only a sublevel as argument, <span class="monospaced">crm</span> enters the interactive
  mode. In this mode, it acts as its own command shell, which
  remembers which sublevel you are currently in and allows for rapid
  and convenient execution of multiple commands within the same
  sublevel. This mode also has full tab completion, as well as
  built-in interactive help and syntax highlighting.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here are a few examples of using <span class="monospaced">crm</span> both as a command-line tool and
as an interactive shell:</p></div>
<div class="literalblock">
<div class="title">Command line (one-shot) use:</div>
<div class="content monospaced">
<pre># crm resource stop www_app</pre>
</div></div>
<div class="literalblock">
<div class="title">Interactive use:</div>
<div class="content monospaced">
<pre># crm
crm(live)# resource
crm(live)resource# unmanage tetris_1
crm(live)resource# up
crm(live)# node standby node4</pre>
</div></div>
<div class="literalblock">
<div class="title">Cluster configuration:</div>
<div class="content monospaced">
<pre># crm configure&lt;&lt;EOF
  #
  # resources
  #
  primitive disk0 iscsi \
    params portal=192.168.2.108:3260 target=iqn.2008-07.com.suse:disk0
  primitive fs0 Filesystem \
    params device=/dev/disk/by-label/disk0 directory=/disk0 fstype=ext3
  primitive internal_ip IPaddr params ip=192.168.1.101
  primitive apache apache \
    params configfile=/disk0/etc/apache2/site0.conf
  primitive apcfence stonith:apcsmart \
    params ttydev=/dev/ttyS0 hostlist="node1 node2" \
    op start timeout=60s
  primitive pingd pingd \
    params name=pingd dampen=5s multiplier=100 host_list="r1 r2"
  #
  # monitor apache and the UPS
  #
  monitor apache 60s:30s
  monitor apcfence 120m:60s
  #
  # cluster layout
  #
  group internal_www \
    disk0 fs0 internal_ip apache
  clone fence apcfence \
    meta globally-unique=false clone-max=2 clone-node-max=1
  clone conn pingd \
    meta globally-unique=false clone-max=2 clone-node-max=1
  location node_pref internal_www \
    rule 50: #uname eq node1 \
    rule pingd: defined pingd
  #
  # cluster properties
  #
  property stonith-enabled=true
  commit
EOF</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">crm</span> interface is hierarchical, with commands organized into
separate levels by functionality. To list the available levels and
commands, either execute <span class="monospaced">help &lt;level&gt;</span>, or, if at the top level of
the shell, simply typing <span class="monospaced">help</span> will provide an overview of all
available levels and commands.</p></div>
<div class="paragraph"><p>The <span class="monospaced">(live)</span> string in the <span class="monospaced">crm</span> prompt signifies that the current CIB
in use is the cluster live configuration. It is also possible to
work with so-called <a href="#topics_Features_Shadows">shadow CIBs</a>. These are separate, inactive
configurations stored in files, that can be applied and thereby
replace the live configuration at any time.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Introduction_Completion">Tab completion</h3>
<div class="paragraph"><p>The <span class="monospaced">crm</span> makes extensive use of tab completion. The completion
is both static (i.e. for <span class="monospaced">crm</span> commands) and dynamic. The latter
takes into account the current status of the cluster or
information from installed resource agents. Sometimes, completion
may also be used to get short help on resource parameters. Here
are a few examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)resource# &lt;TAB&gt;&lt;TAB&gt;
bye           failcount     move          restart       unmigrate
cd            help          param         show          unmove
cleanup       list          promote       start         up
demote        manage        quit          status        utilization
end           meta          refresh       stop
exit          migrate       reprobe       unmanage

crm(live)configure# primitive fence-1 &lt;TAB&gt;&lt;TAB&gt;
heartbeat:  lsb:    ocf:    stonith:

crm(live)configure# primitive fence-1 stonith:&lt;TAB&gt;&lt;TAB&gt;
apcmaster                external/ippower9258     fence_legacy
apcmastersnmp            external/kdumpcheck      ibmhmc
apcsmart                 external/libvirt         ipmilan

crm(live)configure# primitive fence-1 stonith:ipmilan params &lt;TAB&gt;&lt;TAB&gt;
auth=      hostname=  ipaddr=    login=     password=  port=      priv=

crm(live)configure# primitive fence-1 stonith:ipmilan params auth=&lt;TAB&gt;&lt;TAB&gt;
auth* (string)
    The authorization type of the IPMI session ("none", "straight", "md2", or "md5")</pre>
</div></div>
<div class="paragraph"><p><span class="monospaced">crmsh</span> also comes with bash completion usable directly from the
system shell. This should be installed automatically with the command
itself.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Introduction_Shorthand">Shorthand syntax</h3>
<div class="paragraph"><p>When using the <span class="monospaced">crm</span> shell to manage clusters, you will end up typing
a lot of commands many times over. Clear command names like
<span class="monospaced">configure</span> help in understanding and learning to use the cluster
shell, but is easy to misspell and is tedious to type repeatedly. The
interactive mode and tab completion both help with this, but the <span class="monospaced">crm</span>
shell also has the ability to understand a variety of shorthand
aliases for all of the commands.</p></div>
<div class="paragraph"><p>For example, instead of typing <span class="monospaced">crm status</span>, you can type <span class="monospaced">crm st</span> or
<span class="monospaced">crm stat</span>. Instead of <span class="monospaced">crm configure</span> you can type <span class="monospaced">crm cfg</span> or even
<span class="monospaced">crm cf</span>. <span class="monospaced">crm resource</span> can be shorted as <span class="monospaced">crm rsc</span>, and so on.</p></div>
<div class="paragraph"><p>The exact list of accepted aliases is too long to print in full, but
experimentation and typos should help in discovering more of them.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="topics_Features">Features</h2>
<div class="sectionbody">
<div class="paragraph"><p>The feature set of crmsh covers a wide range of functionality, and
understanding how and when to use the various features of the shell
can be difficult. This section of the guide describes some of the
features and use cases of <span class="monospaced">crmsh</span> in more depth. The intention is to
provide a deeper understanding of these features, but also to serve as
a guide to using them.</p></div>
<div class="sect2">
<h3 id="topics_Features_Shadows">Shadow CIB usage</h3>
<div class="paragraph"><p>A Shadow CIB is a normal cluster configuration stored in a file.
They may be manipulated in much the same way as the <em>live</em> CIB, with
the key difference that changes to a shadow CIB have no effect on the
actual cluster resources. An administrator may choose to apply any of
them to the cluster, thus replacing the running configuration with the
one found in the shadow CIB.</p></div>
<div class="paragraph"><p>The <span class="monospaced">crm</span> prompt always contains the name of the configuration which
is currently in use, or the string <em>live</em> if using the live cluster
configuration.</p></div>
<div class="paragraph"><p>When editing the configuration in the <span class="monospaced">configure</span> level, no changes
are actually applied until the <span class="monospaced">commit</span> command is executed. It is
possible to start editing a configuration as usual, but instead of
committing the changes to the active CIB, save them to a shadow CIB.</p></div>
<div class="paragraph"><p>The following example <span class="monospaced">configure</span> session demonstrates how this can be
done:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# cib new test-2
INFO: test-2 shadow CIB created
crm(test-2)configure# commit</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="topics_Features_Checks">Configuration semantic checks</h3>
<div class="paragraph"><p>Resource definitions may be checked against the meta-data
provided with the resource agents. These checks are currently
carried out:</p></div>
<div class="ulist"><ul>
<li>
<p>
are required parameters set
</p>
</li>
<li>
<p>
existence of defined parameters
</p>
</li>
<li>
<p>
timeout values for operations
</p>
</li>
</ul></div>
<div class="paragraph"><p>The parameter checks are obvious and need no further explanation.
Failures in these checks are treated as configuration errors.</p></div>
<div class="paragraph"><p>The timeouts for operations should be at least as long as those
recommended in the meta-data. Too short timeout values are a
common mistake in cluster configurations and, even worse, they
often slip through if cluster testing was not thorough. Though
operation timeouts issues are treated as warnings, make sure that
the timeouts are usable in your environment. Note also that the
values given are just <em>advisory minimum</em>---your resources may
require longer timeouts.</p></div>
<div class="paragraph"><p>User may tune the frequency of checks and the treatment of errors
by the <a href="#cmdhelp_options_check-frequency"><span class="monospaced">check-frequency</span></a> and
<a href="#cmdhelp_options_check-mode"><span class="monospaced">check-mode</span></a> preferences.</p></div>
<div class="paragraph"><p>Note that if the <span class="monospaced">check-frequency</span> is set to <span class="monospaced">always</span> and the
<span class="monospaced">check-mode</span> to <span class="monospaced">strict</span>, errors are not tolerated and such
configuration cannot be saved.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Features_Templates">Configuration templates</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Deprecation note</div>
<div class="paragraph"><p>Configuration templates have been deprecated in favor of the more
capable <span class="monospaced">cluster scripts</span>. To learn how to use cluster scripts, see
the dedicated documentation on the <span class="monospaced">crmsh</span> website at
<a href="http://crmsh.github.io/">http://crmsh.github.io/</a>, or in the <a href="#cmdhelp_script">Script section</a>.</p></div>
</div></div>
<div class="paragraph"><p>Configuration templates are ready made configurations created by
cluster experts. They are designed in such a way so that users
may generate valid cluster configurations with minimum effort.
If you are new to Pacemaker, templates may be the best way to
start.</p></div>
<div class="paragraph"><p>We will show here how to create a simple yet functional Apache
configuration:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># crm configure
crm(live)configure# template
crm(live)configure template# list templates
apache       filesystem   virtual-ip
crm(live)configure template# new web &lt;TAB&gt;&lt;TAB&gt;
apache       filesystem   virtual-ip
crm(live)configure template# new web apache
INFO: pulling in template apache
INFO: pulling in template virtual-ip
crm(live)configure template# list
web2-d       web2     vip2     web3     vip      web</pre>
</div></div>
<div class="paragraph"><p>We enter the <span class="monospaced">template</span> level from <span class="monospaced">configure</span>. Use the <span class="monospaced">list</span>
command to show templates available on the system. The <span class="monospaced">new</span>
command creates a configuration from the <span class="monospaced">apache</span> template. You
can use tab completion to pick templates. Note that the apache
template depends on a virtual IP address which is automatically
pulled along. The <span class="monospaced">list</span> command shows the just created <span class="monospaced">web</span>
configuration, among other configurations (I hope that you,
unlike me, will use more sensible and descriptive names).</p></div>
<div class="paragraph"><p>The <span class="monospaced">show</span> command, which displays the resulting configuration,
may be used to get an idea about the minimum required changes
which have to be done. All <span class="monospaced">ERROR</span> messages show the line numbers
in which the respective parameters are to be defined:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure template# show
ERROR: 23: required parameter ip not set
ERROR: 61: required parameter id not set
ERROR: 65: required parameter configfile not set
crm(live)configure template# edit</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">edit</span> command invokes the preferred text editor with the
<span class="monospaced">web</span> configuration. At the top of the file, the user is advised
how to make changes. A good template should require from the user
to specify only parameters. For example, the <span class="monospaced">web</span> configuration
we created above has the following required and optional
parameters (all parameter lines start with <span class="monospaced">%%</span>):</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$ grep -n ^%% ~/.crmconf/web
23:%% ip
31:%% netmask
35:%% lvs_support
61:%% id
65:%% configfile
71:%% options
76:%% envfiles</pre>
</div></div>
<div class="paragraph"><p>These lines are the only ones that should be modified. Simply
append the parameter value at the end of the line. For instance,
after editing this template, the result could look like this (we
used tabs instead of spaces to make the values stand out):</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$ grep -n ^%% ~/.crmconf/web
23:%% ip        192.168.1.101
31:%% netmask
35:%% lvs_support
61:%% id        websvc
65:%% configfile    /etc/apache2/httpd.conf
71:%% options
76:%% envfiles</pre>
</div></div>
<div class="paragraph"><p>As you can see, the parameter line format is very simple:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>%% &lt;name&gt; &lt;value&gt;</pre>
</div></div>
<div class="paragraph"><p>After editing the file, use <span class="monospaced">show</span> again to display the
configuration:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure template# show
primitive virtual-ip IPaddr \
    params ip=192.168.1.101
primitive apache apache \
    params configfile="/etc/apache2/httpd.conf"
monitor apache 120s:60s
group websvc \
    apache virtual-ip</pre>
</div></div>
<div class="paragraph"><p>The target resource of the apache template is a group which we
named <span class="monospaced">websvc</span> in this sample session.</p></div>
<div class="paragraph"><p>This configuration looks exactly as you could type it at the
<span class="monospaced">configure</span> level. The point of templates is to save you some
typing. It is important, however, to understand the configuration
produced.</p></div>
<div class="paragraph"><p>Finally, the configuration may be applied to the current
crm configuration (note how the configuration changed slightly,
though it is still equivalent, after being digested at the
<span class="monospaced">configure</span> level):</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure template# apply
crm(live)configure template# cd ..
crm(live)configure# show
node xen-b
node xen-c
primitive apache apache \
    params configfile="/etc/apache2/httpd.conf" \
    op monitor interval=120s timeout=60s
primitive virtual-ip IPaddr \
    params ip=192.168.1.101
group websvc apache virtual-ip</pre>
</div></div>
<div class="paragraph"><p>Note that this still does not commit the configuration to the CIB
which is used in the shell, either the running one (<span class="monospaced">live</span>) or
some shadow CIB. For that you still need to execute the <span class="monospaced">commit</span>
command.</p></div>
<div class="paragraph"><p>To complete our example, we should also define the preferred node
to run the service:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# location websvc-pref websvc 100: xen-b</pre>
</div></div>
<div class="paragraph"><p>If you are not happy with some resource names which are provided
by default, you can rename them now:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# rename virtual-ip intranet-ip
crm(live)configure# show
node xen-b
node xen-c
primitive apache apache \
    params configfile="/etc/apache2/httpd.conf" \
    op monitor interval=120s timeout=60s
primitive intranet-ip IPaddr \
    params ip=192.168.1.101
group websvc apache intranet-ip
location websvc-pref websvc 100: xen-b</pre>
</div></div>
<div class="paragraph"><p>To summarize, working with templates typically consists of the
following steps:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">new</span>: create a new configuration from templates
</p>
</li>
<li>
<p>
<span class="monospaced">edit</span>: define parameters, at least the required ones
</p>
</li>
<li>
<p>
<span class="monospaced">show</span>: see if the configuration is valid
</p>
</li>
<li>
<p>
<span class="monospaced">apply</span>: apply the configuration to the <span class="monospaced">configure</span> level
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="topics_Features_Testing">Resource testing</h3>
<div class="paragraph"><p>The amount of detail in a cluster makes all configurations prone
to errors. By far the largest number of issues in a cluster is
due to bad resource configuration. The shell can help quickly
diagnose such problems. And considerably reduce your keyboard
wear.</p></div>
<div class="paragraph"><p>Let&#8217;s say that we entered the following configuration:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node xen-b
node xen-c
node xen-d
primitive fencer stonith:external/libvirt \
    params hypervisor_uri="qemu+tcp://10.2.13.1/system" \
        hostlist="xen-b xen-c xen-d" \
    op monitor interval=2h
primitive svc Xinetd \
    params service=systat \
    op monitor interval=30s
primitive intranet-ip IPaddr2 \
    params ip=10.2.13.100 \
    op monitor interval=30s
primitive apache apache \
    params configfile="/etc/apache2/httpd.conf" \
    op monitor interval=120s timeout=60s
group websvc apache intranet-ip
location websvc-pref websvc 100: xen-b</pre>
</div></div>
<div class="paragraph"><p>Before typing <span class="monospaced">commit</span> to submit the configuration to the cib we
can make sure that all resources are usable on all nodes:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# rsctest websvc svc fencer</pre>
</div></div>
<div class="paragraph"><p>It is important that resources being tested are not running on
any nodes. Otherwise, the <span class="monospaced">rsctest</span> command will refuse to do
anything. Of course, if the current configuration resides in a
CIB shadow, then a <span class="monospaced">commit</span> is irrelevant. The point being that
resources are not running on any node.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on stopping all resources</div>
<div class="paragraph"><p>Alternatively to not committing a configuration, it is also
possible to tell Pacemaker not to start any resources:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# property stop-all-resources=yes</pre>
</div></div>
<div class="paragraph"><p>Almost none---resources of class stonith are still started. But
shell is not as strict when it comes to stonith resources.</p></div>
</div></div>
<div class="paragraph"><p>Order of resources is significant insofar that a resource depends
on all resources to its left. In most configurations, it&#8217;s
probably practical to test resources in several runs, based on
their dependencies.</p></div>
<div class="paragraph"><p>Apart from groups, <span class="monospaced">crm</span> does not interpret constraints and
therefore knows nothing about resource dependencies. It also
doesn&#8217;t know if a resource can run on a node at all in case of an
asymmetric cluster. It is up to the user to specify a list of
eligible nodes if a resource is not meant to run on every node.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Features_Security">Access Control Lists (ACL)</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on ACLs in Pacemaker 1.1.12</div>
<div class="paragraph"><p>The support for ACLs has been revised in Pacemaker version 1.1.12 and
up. Depending on which version you are using, the information in this
section may no longer be accurate. Look for the <span class="monospaced">acl_target</span>
configuration element for more details on the new syntax.</p></div>
</div></div>
<div class="paragraph"><p>By default, the users from the <span class="monospaced">haclient</span> group have full access
to the cluster (or, more precisely, to the CIB). Access control
lists allow for finer access control to the cluster.</p></div>
<div class="paragraph"><p>Access control lists consist of an ordered set of access rules.
Each rule allows read or write access or denies access
completely. Rules are typically combined to produce a specific
role. Then, users may be assigned a role.</p></div>
<div class="paragraph"><p>For instance, this is a role which defines a set of rules
allowing management of a single resource:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>role bigdb_admin \
    write meta:bigdb:target-role \
    write meta:bigdb:is-managed \
    write location:bigdb \
    read ref:bigdb</pre>
</div></div>
<div class="paragraph"><p>The first two rules allow modifying the <span class="monospaced">target-role</span> and
<span class="monospaced">is-managed</span> meta attributes which effectively enables users in
this role to stop/start and manage/unmanage the resource. The
constraints write access rule allows moving the resource around.
Finally, the user is granted read access to the resource
definition.</p></div>
<div class="paragraph"><p>For proper operation of all Pacemaker programs, it is advisable
to add the following role to all users:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>role read_all \
    read cib</pre>
</div></div>
<div class="paragraph"><p>For finer grained read access try with the rules listed in the
following role:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>role basic_read \
    read node attribute:uname \
    read node attribute:type \
    read property \
    read status</pre>
</div></div>
<div class="paragraph"><p>It is however possible that some Pacemaker programs (e.g.
<span class="monospaced">ptest</span>) may not function correctly if the whole CIB is not
readable.</p></div>
<div class="paragraph"><p>Some of the ACL rules in the examples above are expanded by the
shell to XPath specifications. For instance,
<span class="monospaced">meta:bigdb:target-role</span> expands to:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>//primitive[@id='bigdb']/meta_attributes/nvpair[@name='target-role']</pre>
</div></div>
<div class="paragraph"><p>You can see the expansion by showing XML:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live) configure# show xml bigdb_admin
...
&lt;acls&gt;
  &lt;acl_role id="bigdb_admin"&gt;
      &lt;write id="bigdb_admin-write"
      xpath="//primitive[@id='bigdb']/meta_attributes/nvpair[@name='target-role']"/&gt;</pre>
</div></div>
<div class="paragraph"><p>Many different XPath expressions can have equal meaning. For
instance, the following two are equal, but only the first one is
going to be recognized as shortcut:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>//primitive[@id='bigdb']/meta_attributes/nvpair[@name='target-role']
//resources/primitive[@id='bigdb']/meta_attributes/nvpair[@name='target-role']</pre>
</div></div>
<div class="paragraph"><p>XPath is a powerful language, but you should try to keep your ACL
xpaths simple and the builtin shortcuts should be used whenever
possible.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Features_Resourcesets">Syntax: Resource sets</h3>
<div class="paragraph"><p>Using resource sets can be a bit confusing unless one knows the
details of the implementation in Pacemaker as well as how to interpret
the syntax provided by <span class="monospaced">crmsh</span>.</p></div>
<div class="paragraph"><p>Three different types of resource sets are provided by <span class="monospaced">crmsh</span>, and
each one implies different values for the two resource set attributes,
<span class="monospaced">sequential</span> and <span class="monospaced">require-all</span>.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">sequential</span>
</dt>
<dd>
<p>
  If false, the resources in the set do not depend on each other
  internally. Setting <span class="monospaced">sequential</span> to <span class="monospaced">true</span> implies a strict order of
  dependency within the set.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">require-all</span>
</dt>
<dd>
<p>
  If false, only one resource in the set is required to fulfil the
  requirements of the set. The set of A, B and C with <span class="monospaced">require-all</span>
  set to <span class="monospaced">false</span> is be read as "A OR B OR C" when its dependencies
  are resolved.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The three types of resource sets modify the attributes in the
following way:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Implicit sets (no brackets). <span class="monospaced">sequential=true</span>, <span class="monospaced">require-all=true</span>
</p>
</li>
<li>
<p>
Parenthesis set (<span class="monospaced">(</span> &#8230; <span class="monospaced">)</span>). <span class="monospaced">sequential=false</span>, <span class="monospaced">require-all=true</span>
</p>
</li>
<li>
<p>
Bracket set (<span class="monospaced">[</span> &#8230; <span class="monospaced">]</span>). <span class="monospaced">sequential=false</span>, <span class="monospaced">require-all=false</span>
</p>
</li>
</ol></div>
<div class="paragraph"><p>To create a set with the properties <span class="monospaced">sequential=true</span> and
<span class="monospaced">require-all=false</span>, explicitly set <span class="monospaced">sequential</span> in a bracketed set,
<span class="monospaced">[ A B C sequential=true ]</span>.</p></div>
<div class="paragraph"><p>To create multiple sets with both <span class="monospaced">sequential</span> and <span class="monospaced">require-all</span> set to
true, explicitly set <span class="monospaced">sequential</span> in a parenthesis set:
<span class="monospaced">A B ( C D sequential=true )</span>.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Features_AttributeListReferences">Syntax: Attribute list references</h3>
<div class="paragraph"><p>Attribute lists are used to set attributes and parameters for
resources, constraints and property definitions. For example, to set
the virtual IP used by an <span class="monospaced">IPAddr2</span> resource the attribute <span class="monospaced">ip</span> can be
set in an attribute list for that resource.</p></div>
<div class="paragraph"><p>Attribute lists can have identifiers that name them, and other
resources can reuse the same attribute list by referring to that name
using an <span class="monospaced">$id-ref</span>. For example, the following statement defines a
simple dummy resource with an attribute list which sets the parameter
<span class="monospaced">state</span> to the value 1 and sets the identifier for the attribute list
to <span class="monospaced">on-state</span>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive dummy-1 Dummy params $id=on-state state=1</pre>
</div></div>
<div class="paragraph"><p>To refer to this attribute list from a different resource, refer to
the <span class="monospaced">on-state</span> name using an id-ref:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive dummy-2 Dummy params $id-ref=on-state</pre>
</div></div>
<div class="paragraph"><p>The resource <span class="monospaced">dummy-2</span> will now also have the parameter <span class="monospaced">state</span> set to the value 1.</p></div>
</div>
<div class="sect2">
<h3 id="topics_Features_AttributeReferences">Syntax: Attribute references</h3>
<div class="paragraph"><p>In some cases, referencing complete attribute lists is too
coarse-grained, for example if two different parameters with different
names should have the same value set. Instead of having to copy the
value in multiple places, it is possible to create references to
individual attributes in attribute lists.</p></div>
<div class="paragraph"><p>To name an attribute in order to be able to refer to it later, prefix
the attribute name with a <span class="monospaced">$</span> character (as seen above with the
special names <span class="monospaced">$id</span> and <span class="monospaced">$id-ref</span>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive dummy-1 Dummy params $state=1</pre>
</div></div>
<div class="paragraph"><p>The identifier <span class="monospaced">state</span> can now be used to refer to this attribute from other
primitives, using the <span class="monospaced">@&lt;id&gt;</span> syntax:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive dummy-2 Dummy params @state</pre>
</div></div>
<div class="paragraph"><p>In some cases, using the attribute name as the identifier doesn&#8217;t work
due to name clashes. In this case, the syntax <span class="monospaced">$&lt;id&gt;:&lt;name&gt;=&lt;value&gt;</span>
can be used to give the attribute a different identifier:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive dummy-1 params $dummy-state-on:state=1
primitive dummy-2 params @dummy-state-on</pre>
</div></div>
<div class="paragraph"><p>There is also the possibility that two resources both use the same
attribute value but with different names. For example, a web server
may have a parameter <span class="monospaced">server_ip</span> for setting the IP address where it
listens for incoming requests, and a virtual IP resource may have a
parameter called <span class="monospaced">ip</span> which sets the IP address it creates. To
configure these two resources with an IP without repeating the value,
the reference can be given a name using the syntax <span class="monospaced">@&lt;id&gt;:&lt;name&gt;</span>.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive virtual-ip IPaddr2 params $vip:ip=192.168.1.100
primitive webserver apache params @vip:server_ip</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="topics_Syntax_RuleExpressions">Syntax: Rule expressions</h3>
<div class="paragraph"><p>Many of the configuration commands in <span class="monospaced">crmsh</span> now support the use of
<em>rule expressions</em>, which can influence what attributes apply to a
resource or under which conditions a constraint is applied, depending
on changing conditions like date, time, the value of attributes and
more.</p></div>
<div class="paragraph"><p>Here is an example of a simple rule expression used to apply a
a different resource parameter on the node named <span class="monospaced">node1</span>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive my_resource Special \
  params 2: rule #uname eq node1 interface=eth1 \
  params 1: interface=eth0</pre>
</div></div>
<div class="paragraph"><p>This primitive resource has two lists of parameters with descending
priority. The parameter list with the highest priority is applied
first, but only if the rule expressions for that parameter list all
apply. In this case, the rule <span class="monospaced">#uname eq node1</span> limits the parameter
list so that it is only applied on <span class="monospaced">node1</span>.</p></div>
<div class="paragraph"><p>Note that rule expressions are not terminated and are immediately
followed by the data to which the rule is applied. In this case, the
name-value pair <span class="monospaced">interface=eth1</span>.</p></div>
<div class="paragraph"><p>Rule expressions can contain multiple expressions connected using the
boolean operator <span class="monospaced">or</span> and <span class="monospaced">and</span>. The full syntax for rule expressions
is listed below.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rules ::
  rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;: &lt;expression&gt;
  [rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;: &lt;expression&gt; ...]

id_spec :: $id=&lt;id&gt; | $id-ref=&lt;id&gt;
score :: &lt;number&gt; | &lt;attribute&gt; | [-]inf
expression :: &lt;simple_exp&gt; [&lt;bool_op&gt; &lt;simple_exp&gt; ...]
bool_op :: or | and
simple_exp :: &lt;attribute&gt; [type:]&lt;binary_op&gt; &lt;value&gt;
          | &lt;unary_op&gt; &lt;attribute&gt;
          | date &lt;date_expr&gt;
type :: &lt;string&gt; | &lt;version&gt; | &lt;number&gt;
binary_op :: lt | gt | lte | gte | eq | ne
unary_op :: defined | not_defined

date_expr :: lt &lt;end&gt;
         | gt &lt;start&gt;
         | in start=&lt;start&gt; end=&lt;end&gt;
         | in start=&lt;start&gt; &lt;duration&gt;
         | spec &lt;date_spec&gt;
duration|date_spec ::
         hours=&lt;value&gt;
         | monthdays=&lt;value&gt;
         | weekdays=&lt;value&gt;
         | yearsdays=&lt;value&gt;
         | months=&lt;value&gt;
         | weeks=&lt;value&gt;
         | years=&lt;value&gt;
         | weekyears=&lt;value&gt;
         | moon=&lt;value&gt;</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="topics_Reference">Command reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>The commands are structured to be compatible with the shell command
line. Sometimes, the underlying Pacemaker grammar uses characters that
have special meaning in bash, that will need to be quoted. This
includes the hash or pound sign (<span class="monospaced">#</span>), single and double quotes, and
any significant whitespace.</p></div>
<div class="paragraph"><p>Whitespace is also significant when assigning values, meaning that
<span class="monospaced">key=value</span> is different from <span class="monospaced">key = value</span>.</p></div>
<div class="paragraph"><p>Commands can be referenced using short-hand as long as the short-hand
is unique. This can be either a prefix of the command name or a prefix
string of characters found in the name.</p></div>
<div class="paragraph"><p>For example, <span class="monospaced">status</span> can be abbreviated as <span class="monospaced">st</span> or <span class="monospaced">su</span>, and
<span class="monospaced">configure</span> as <span class="monospaced">conf</span> or <span class="monospaced">cfg</span>.</p></div>
<div class="paragraph"><p>The syntax for the commands is given below in an informal, BNF-like
grammar.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">&lt;value&gt;</span> denotes a string.
</p>
</li>
<li>
<p>
<span class="monospaced">[value]</span> means that the construct is optional.
</p>
</li>
<li>
<p>
The ellipsis (<span class="monospaced">...</span>) signifies that the previous construct may be
  repeated.
</p>
</li>
<li>
<p>
<span class="monospaced">first|second</span> means either first or second.
</p>
</li>
<li>
<p>
The rest are literals (strings, <span class="monospaced">:</span>, <span class="monospaced">=</span>).
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="cmdhelp_root_status"><span class="monospaced">status</span></h3>
<div class="paragraph"><p>Show cluster status. The status is displayed by <span class="monospaced">crm_mon</span>. Supply
additional arguments for more information or different format.
See <span class="monospaced">crm_mon(8)</span> for more details.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status
status simple
status full</pre>
</div></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status [&lt;option&gt; ...]

option :: full
        | bynode
        | inactive
        | ops
        | timing
        | failcounts
        | verbose
        | quiet
        | html
        | xml
        | simple
        | tickets
        | noheaders
        | detail
        | brief</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="cmdhelp_root_verify"><span class="monospaced">verify</span></h3>
<div class="paragraph"><p>Performs basic checks for the cluster configuration and
current status, reporting potential issues.</p></div>
<div class="paragraph"><p>See <span class="monospaced">crm_verify(8)</span> and <span class="monospaced">crm_simulate(8)</span> for more details.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>verify
verify scores</pre>
</div></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>verify [scores]</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="cmdhelp_cluster"><span class="monospaced">cluster</span> - Cluster setup and management</h3>
<div class="paragraph"><p>Whole-cluster configuration management with High Availability
awareness.</p></div>
<div class="paragraph"><p>The commands on the cluster level allows configuration and
modification of the underlying cluster infrastructure, and also
supplies tools to do whole-cluster systems management.</p></div>
<div class="paragraph"><p>These commands enable easy installation and maintenance of a HA
cluster, by providing support for package installation, configuration
of the cluster messaging layer, file system setup and more.</p></div>
<div class="sect3">
<h4 id="cmdhelp_cluster_add"><span class="monospaced">add</span></h4>
<div class="paragraph"><p>Add a new node to the cluster. The new node will be
configured as a cluster member.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-y, --yes</strong>
</dt>
<dd>
<p>
    Answer "yes" to all prompts (use with caution)
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>add [options] [&lt;node&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_copy"><span class="monospaced">copy</span></h4>
<div class="paragraph"><p>Copy file to other cluster nodes.</p></div>
<div class="paragraph"><p>Copies the given file to all other nodes unless given a
list of nodes to copy to as argument.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>copy &lt;filename&gt; [nodes ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>copy /etc/motd</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_diff"><span class="monospaced">diff</span></h4>
<div class="paragraph"><p>Displays the difference, if any, between a given file
on different nodes. If the second argument is <span class="monospaced">--checksum</span>,
a checksum of the file will be calculated and displayed for
each node.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff &lt;file&gt; [--checksum] [nodes...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff /etc/crm/crm.conf node2
diff /etc/resolv.conf --checksum</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_geo_init"><span class="monospaced">geo-init</span></h4>
<div class="paragraph"><p>Create a new geo cluster with the current cluster as the
first member. Pass the complete geo cluster topology as
arguments to this command, and then use <span class="monospaced">geo-join</span> and
<span class="monospaced">geo-init-arbitrator</span> to add the remaining members to
the geo cluster.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-q, --quiet</strong>
</dt>
<dd>
<p>
    Be quiet (don&#8217;t describe what&#8217;s happening, just do it)
</p>
</dd>
<dt class="hdlist1">
<strong>-y, --yes</strong>
</dt>
<dd>
<p>
    Answer "yes" to all prompts (use with caution)
</p>
</dd>
<dt class="hdlist1">
<strong>--arbitrator=IP</strong>
</dt>
<dd>
<p>
    IP address of geo cluster arbitrator
</p>
</dd>
<dt class="hdlist1">
<strong>--clusters=DESC</strong>
</dt>
<dd>
<p>
    Cluster description (see details below)
</p>
</dd>
<dt class="hdlist1">
<strong>--tickets=LIST</strong>
</dt>
<dd>
<p>
    Tickets to create (space-separated)
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Cluster Description:</p></div>
<div class="paragraph"><p>This is a map of cluster names to IP addresses.
Each IP address will be configured as a virtual IP
representing that cluster in the geo cluster
configuration.</p></div>
<div class="paragraph"><p>Example with two clusters named paris and amsterdam:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  --clusters "paris=192.168.10.10 amsterdam=192.168.10.11"</pre>
</div></div>
<div class="paragraph"><p>Name clusters using the <span class="monospaced">--name</span> parameter to <span class="monospaced">init</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>geo-init [options]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_geo_init_arbitrator"><span class="monospaced">geo-init-arbitrator</span></h4>
<div class="paragraph"><p>Configure the current node as a geo arbitrator. The command
requires an existing geo cluster or geo arbitrator from which
to get the geo cluster configuration.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>--clusters=DESC</strong>
</dt>
<dd>
<p>
    Cluster description (see <span class="monospaced">geo-init</span> for details)
</p>
</dd>
<dt class="hdlist1">
<strong>-c IP, --cluster-node=IP</strong>
</dt>
<dd>
<p>
    IP address of an already-configured geo cluster
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>geo-init-arbitrator [options]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_geo_join"><span class="monospaced">geo-join</span></h4>
<div class="paragraph"><p>This command should be run from one of the nodes in a cluster
which is currently not a member of a geo cluster. The geo
cluster configuration will be fetched from the provided node,
and the cluster will be added to the geo cluster.</p></div>
<div class="paragraph"><p>Note that each cluster in a geo cluster needs to have a unique
name set. The cluster name can be set using the <span class="monospaced">--name</span> argument
to <span class="monospaced">init</span>, or by configuring corosync with the cluster name in
an existing cluster.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-c IP, --cluster-node=IP</strong>
</dt>
<dd>
<p>
    IP address of an already-configured geo cluster or arbitrator
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>geo-join [options]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_health"><span class="monospaced">health</span></h4>
<div class="paragraph"><p>Runs a larger set of tests and queries on all nodes in the cluster to
verify the general system health and detect potential problems.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>health</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_init"><span class="monospaced">init</span></h4>
<div class="paragraph"><p>Initialize a cluster from scratch. This command configures
a complete cluster, and can also add additional cluster
nodes to the initial one-node cluster using the <span class="monospaced">--nodes</span>
option.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-q, --quiet</strong>
</dt>
<dd>
<p>
    Be quiet (don&#8217;t describe what&#8217;s happening, just do it)
</p>
</dd>
<dt class="hdlist1">
<strong>-y, --yes</strong>
</dt>
<dd>
<p>
    Answer "yes" to all prompts (use with caution, this
    is destructive, especially during the "storage" stage)
</p>
</dd>
<dt class="hdlist1">
<strong>-t TEMPLATE, --template=TEMPLATE</strong>*
</dt>
<dd>
<p>
    Optionally configure cluster with template "name"
    (currently only "ocfs2" is valid here)
</p>
</dd>
<dt class="hdlist1">
<strong>-n NAME, --name=NAME</strong>
</dt>
<dd>
<p>
    Set the name of the configured cluster.
</p>
</dd>
<dt class="hdlist1">
<strong>-N NODES, --nodes=NODES</strong>
</dt>
<dd>
<p>
    Additional nodes to add to the created cluster. May
    include the current node, which will always be the
    initial cluster node.
</p>
</dd>
<dt class="hdlist1">
<strong>-w WATCHDOG, --watchdog=WATCHDOG</strong>
</dt>
<dd>
<p>
    Use the given watchdog device.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Network configuration:</p></div>
<div class="paragraph"><p>Options for configuring the network and messaging layer.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-i IF, --interface=IF</strong>
</dt>
<dd>
<p>
    Bind to IP address on interface IF
</p>
</dd>
<dt class="hdlist1">
<strong>-u, --unicast</strong>
</dt>
<dd>
<p>
    Configure corosync to communicate over unicast (UDP),
    and not multicast. Default is multicast unless an
    environment where multicast cannot be used is
    detected.
</p>
</dd>
<dt class="hdlist1">
<strong>-A IP, --admin-ip=IP</strong>
</dt>
<dd>
<p>
    Configure IP address as an administration virtual IP
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Storage configuration:</p></div>
<div class="paragraph"><p>Options for configuring shared storage.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-p DEVICE, --partition-device=DEVICE</strong>
</dt>
<dd>
<p>
    Partition this shared storage device (only used in
    "storage" stage)
</p>
</dd>
<dt class="hdlist1">
<strong>-s DEVICE, --sbd-device=DEVICE</strong>
</dt>
<dd>
<p>
    Block device to use for SBD fencing
</p>
</dd>
<dt class="hdlist1">
<strong>-o DEVICE, --ocfs2-device=DEVICE</strong>
</dt>
<dd>
<p>
    Block device to use for OCFS2 (only used in "vgfs"
    stage)
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Stage can be one of:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>ssh</strong>
</dt>
<dd>
<p>
    Create SSH keys for passwordless SSH between cluster nodes
</p>
</dd>
<dt class="hdlist1">
<strong>csync2</strong>
</dt>
<dd>
<p>
    Configure csync2
</p>
</dd>
<dt class="hdlist1">
<strong>corosync</strong>
</dt>
<dd>
<p>
    Configure corosync
</p>
</dd>
<dt class="hdlist1">
<strong>storage</strong>
</dt>
<dd>
<p>
    Partition shared storage (ocfs2 template only)
</p>
</dd>
<dt class="hdlist1">
<strong>sbd</strong>
</dt>
<dd>
<p>
    Configure SBD (requires -s &lt;dev&gt;)
</p>
</dd>
<dt class="hdlist1">
<strong>cluster</strong>
</dt>
<dd>
<p>
    Bring the cluster online
</p>
</dd>
<dt class="hdlist1">
<strong>vgfs</strong>
</dt>
<dd>
<p>
    Create volume group and filesystem (ocfs2 template only, requires <span class="monospaced">-o &lt;dev&gt;</span>)
</p>
</dd>
<dt class="hdlist1">
<strong>admin</strong>
</dt>
<dd>
<p>
    Create administration virtual IP (optional)
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="/img/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="ulist"><ul>
<li>
<p>
If stage is not specified, the script will run through each stage
  in sequence, with prompts for required information.
</p>
</li>
<li>
<p>
If using the ocfs2 template, the storage stage will partition a block
  device into two pieces, one for SBD, the remainder for OCFS2.  This is
  good for testing and demonstration, but not ideal for production.
  To use storage you have already configured, pass -s and -o to specify
  the block devices for SBD and OCFS2, and the automatic partitioning
  will be skipped.
</p>
</li>
</ul></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>init [options] [STAGE]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_join"><span class="monospaced">join</span></h4>
<div class="paragraph"><p>Join the current node to an existing cluster. The
current node cannot be a member of a cluster already.
Pass any node in the existing cluster as the argument
to the <span class="monospaced">-c</span> option.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-q, --quiet</strong>
</dt>
<dd>
<p>
    Be quiet (don&#8217;t describe what&#8217;s happening, just do it)
</p>
</dd>
<dt class="hdlist1">
<strong>-y, --yes</strong>
</dt>
<dd>
<p>
    Answer "yes" to all prompts (use with caution)
</p>
</dd>
<dt class="hdlist1">
<strong>-w WATCHDOG, --watchdog=WATCHDOG</strong>
</dt>
<dd>
<p>
    Use the given watchdog device
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Network configuration:</p></div>
<div class="paragraph"><p>Options for configuring the network and messaging layer.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-c HOST, --cluster-node=HOST</strong>
</dt>
<dd>
<p>
    IP address or hostname of existing cluster node
</p>
</dd>
<dt class="hdlist1">
<strong>-i IF, --interface=IF</strong>
</dt>
<dd>
<p>
    Bind to IP address on interface IF
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Stage can be one of:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>ssh</strong>
</dt>
<dd>
<p>
    Obtain SSH keys from existing cluster node (requires -c &lt;host&gt;)
</p>
</dd>
<dt class="hdlist1">
<strong>csync2</strong>
</dt>
<dd>
<p>
    Configure csync2 (requires -c &lt;host&gt;)
</p>
</dd>
<dt class="hdlist1">
<strong>ssh_merge</strong>
</dt>
<dd>
<p>
    Merge root&#8217;s SSH known_hosts across all nodes (csync2 must
    already be configured).
</p>
</dd>
<dt class="hdlist1">
<strong>cluster</strong>
</dt>
<dd>
<p>
    Start the cluster on this node
</p>
</dd>
</dl></div>
<div class="paragraph"><p>If stage is not specified, each stage will be invoked in sequence.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>join [options] [STAGE]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_remove"><span class="monospaced">remove</span></h4>
<div class="paragraph"><p>Remove one or more nodes from the cluster.</p></div>
<div class="paragraph"><p>This command can remove the last node in the cluster,
thus effectively removing the whole cluster. To remove
the last node, pass <span class="monospaced">--force</span> argument to <span class="monospaced">crm</span> or set
the <span class="monospaced">config.core.force</span> option.</p></div>
<div class="paragraph"><p>Options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>-q, --quiet</strong>
</dt>
<dd>
<p>
    Be quiet (don&#8217;t describe what&#8217;s happening, just do it)
</p>
</dd>
<dt class="hdlist1">
<strong>-y, --yes</strong>
</dt>
<dd>
<p>
    Answer "yes" to all prompts (use with caution)
</p>
</dd>
<dt class="hdlist1">
<strong>-c HOST, --cluster-node=HOST</strong>
</dt>
<dd>
<p>
    IP address or hostname of cluster node which will be
    removed from the cluster
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>remove [options] [&lt;node&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_run"><span class="monospaced">run</span></h4>
<div class="paragraph"><p>This command takes a shell statement as argument, executes that
statement on all nodes in the cluster, and reports the result.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>run &lt;command&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>run "cat /proc/uptime"</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_start"><span class="monospaced">start</span></h4>
<div class="paragraph"><p>Starts the cluster-related system services on this node.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>start</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_status"><span class="monospaced">status</span></h4>
<div class="paragraph"><p>Reports the status for the cluster messaging layer on the local
node.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_stop"><span class="monospaced">stop</span></h4>
<div class="paragraph"><p>Stops the cluster-related system services on this node.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>stop</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cluster_wait_for_startup"><span class="monospaced">wait_for_startup</span></h4>
<div class="paragraph"><p>Mostly useful in scripts or automated workflows, this command will
attempt to connect to the local cluster node repeatedly. The command
will keep trying until the cluster node responds, or the <span class="monospaced">timeout</span>
elapses. The timeout can be changed by supplying a value in seconds as
an argument.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>wait_for_startup</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_script"><span class="monospaced">script</span> - Cluster script management</h3>
<div class="paragraph"><p>A big part of the configuration and management of a cluster is
collecting information about all cluster nodes and deploying changes
to those nodes. Often, just performing the same procedure on all nodes
will encounter problems, due to subtle differences in the
configuration.</p></div>
<div class="paragraph"><p>For example, when configuring a cluster for the first time, the
software needs to be installed and configured on all nodes before the
cluster software can be launched and configured using <span class="monospaced">crmsh</span>. This
process is cumbersome and error-prone, and the goal is for scripts to
make this process easier.</p></div>
<div class="paragraph"><p>Scripts are implemented using the python <span class="monospaced">parallax</span> package which
provides a thin wrapper on top of SSH. This allows the scripts to
function through the usual SSH channels used for system maintenance,
requiring no additional software to be installed or maintained.</p></div>
<div class="sect3">
<h4 id="cmdhelp_script_json"><span class="monospaced">json</span></h4>
<div class="paragraph"><p>This command provides a JSON API for the cluster scripts, intended for
use in user interface tools that want to interact with the cluster via
scripts.</p></div>
<div class="paragraph"><p>The command takes a single argument, which should be a JSON array with
the first member identifying the command to perform.</p></div>
<div class="paragraph"><p>The output is line-based: Commands that return multiple results will
return them line-by-line, ending with a terminator value: "end".</p></div>
<div class="paragraph"><p>When providing parameter values to this command, they should be
provided as nested objects, so <span class="monospaced">virtual-ip:ip=192.168.0.5</span> on the
command line becomes the JSON object
<span class="monospaced">{"virtual-ip":{"ip":"192.168.0.5"}}</span>.</p></div>
<div class="paragraph"><p>API:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>["list"]
=&gt; [{name, shortdesc, category}]

["show", &lt;name&gt;]
=&gt; [{name, shortdesc, longdesc, category, &lt;&lt;steps&gt;&gt;}]

&lt;&lt;steps&gt;&gt; := [{name, shortdesc], longdesc, required, parameters, steps}]

&lt;&lt;params&gt;&gt; := [{name, shortdesc, longdesc, required, unique, advanced,
                type, value, example}]

["verify", &lt;name&gt;, &lt;&lt;values&gt;&gt;]
=&gt; [{shortdesc, longdesc, text, nodes}]

["run", &lt;name&gt;, &lt;&lt;values&gt;&gt;]
=&gt; [{shortdesc, rc, output|error}]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_script_list"><span class="monospaced">list</span></h4>
<div class="paragraph"><p>Lists the available scripts, sorted by category. Scripts that have the
special <span class="monospaced">Script</span> category are hidden by default, since they are mainly
used by other scripts or commands. To also show these, pass <span class="monospaced">all</span> as
argument.</p></div>
<div class="paragraph"><p>To get a flat list of script names, not sorted by category, pass
<span class="monospaced">names</span> as an extra argument.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>list [all] [names]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>list
list all names</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_script_run"><span class="monospaced">run</span></h4>
<div class="paragraph"><p>Given a list of parameter values, this command will execute the
actions specified by the cluster script. The format for the parameter
values is the same as for the <span class="monospaced">verify</span> command.</p></div>
<div class="paragraph"><p>Can optionally take at least two parameters:
* <span class="monospaced">nodes=&lt;nodes&gt;</span>: List of nodes that the script runs over
* <span class="monospaced">dry_run=yes|no</span>: If set, the script will not perform any modifications.</p></div>
<div class="paragraph"><p>Additional parameters may be available depending on the script.</p></div>
<div class="paragraph"><p>Use the <span class="monospaced">show</span> command to see what parameters are available.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>run &lt;script&gt; [args...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>run apache install=true
run sbd id=sbd-1 node=node1 sbd_device=/dev/disk/by-uuid/F00D-CAFE</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_script_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Prints a description and short summary of the script, with
descriptions of the accepted parameters.</p></div>
<div class="paragraph"><p>Advanced parameters are hidden by default. To show the complete list
of parameters accepted by the script, pass <span class="monospaced">all</span> as argument.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show &lt;script&gt; [all]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show virtual-ip</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_script_verify"><span class="monospaced">verify</span></h4>
<div class="paragraph"><p>Checks the given parameter values, and returns a list
of actions that will be executed when running the script
if provided the same list of parameter values.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>verify &lt;script&gt; [args...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>verify sbd id=sbd-1 node=node1 sbd_device=/dev/disk/by-uuid/F00D-CAFE</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_corosync"><span class="monospaced">corosync</span> - Corosync management</h3>
<div class="paragraph"><p>Corosync is the underlying messaging layer for most HA clusters.
This level provides commands for editing and managing the corosync
configuration.</p></div>
<div class="sect3">
<h4 id="cmdhelp_corosync_add-node"><span class="monospaced">add-node</span></h4>
<div class="paragraph"><p>Adds a node to the corosync configuration. This is used with the <span class="monospaced">udpu</span>
type configuration in corosync.</p></div>
<div class="paragraph"><p>A nodeid for the added node is generated automatically.</p></div>
<div class="paragraph"><p>Note that this command assumes that only a single ring is used, and
sets only the address for ring0.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>add-node &lt;addr&gt; [name]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_del-node"><span class="monospaced">del-node</span></h4>
<div class="paragraph"><p>Removes a node from the corosync configuration. The argument given is
the <span class="monospaced">ring0_addr</span> address set in the configuration file.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>del-node &lt;addr&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_diff"><span class="monospaced">diff</span></h4>
<div class="paragraph"><p>Diffs the corosync configurations on different nodes. If no nodes are
given as arguments, the corosync configurations on all nodes in the
cluster are compared.</p></div>
<div class="paragraph"><p><span class="monospaced">diff</span> takes an option argument <span class="monospaced">--checksum</span>, to display a checksum
for each file instead of calculating a diff.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff [--checksum] [node...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_edit"><span class="monospaced">edit</span></h4>
<div class="paragraph"><p>Opens the Corosync configuration file in an editor.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>edit</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_get"><span class="monospaced">get</span></h4>
<div class="paragraph"><p>Returns the value configured in <span class="monospaced">corosync.conf</span>, which is not
necessarily the value used in the running configuration. See <span class="monospaced">reload</span>
for telling corosync about configuration changes.</p></div>
<div class="paragraph"><p>The argument is the complete dot-separated path to the value.</p></div>
<div class="paragraph"><p>If there are multiple values configured with the same path, the
command returns all values for that path. For example, to get all
configured <span class="monospaced">ring0_addr</span> values, use this command:</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>get nodelist.node.ring0_addr</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_log"><span class="monospaced">log</span></h4>
<div class="paragraph"><p>Opens the log file specified in the corosync configuration file. If no
log file is configured, this command returns an error.</p></div>
<div class="paragraph"><p>The pager used can be configured either using the PAGER
environment variable or in <span class="monospaced">crm.conf</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>log</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_pull"><span class="monospaced">pull</span></h4>
<div class="paragraph"><p>Gets the corosync configuration from another node and copies
it to this node.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>pull &lt;node&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_push"><span class="monospaced">push</span></h4>
<div class="paragraph"><p>Pushes the corosync configuration file on this node to
the list of nodes provided. If no target nodes are given,
the configuration is pushed to all other nodes in the cluster.</p></div>
<div class="paragraph"><p>It is recommended to use <span class="monospaced">csync2</span> to distribute the cluster
configuration files rather than relying on this command.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>push [node] ...</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>push node-2 node-3</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_reload"><span class="monospaced">reload</span></h4>
<div class="paragraph"><p>Tells all instances of corosync in this cluster to reload
<span class="monospaced">corosync.conf</span>.</p></div>
<div class="paragraph"><p>After pushing a new configuration to all cluster nodes, call this
command to make corosync use the new configuration.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>reload</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_set"><span class="monospaced">set</span></h4>
<div class="paragraph"><p>Sets the value identified by the given path. If the value does not
exist in the configuration file, it will be added. However, if the
section containing the value does not exist, the command will fail.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>set quorum.expected_votes 2</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Displays the corosync configuration on the current node.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_corosync_status"><span class="monospaced">status</span></h4>
<div class="paragraph"><p>Displays the status of Corosync, including the votequorum state.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_cib"><span class="monospaced">cib</span> - CIB shadow management</h3>
<div class="paragraph"><p>This level is for management of shadow CIBs. It is available both
at the top level and the <span class="monospaced">configure</span> level.</p></div>
<div class="paragraph"><p>All the commands are implemented using <span class="monospaced">cib_shadow(8)</span> and the
<span class="monospaced">CIB_shadow</span> environment variable. The user prompt always
includes the name of the currently active shadow or the live CIB.</p></div>
<div class="sect3">
<h4 id="cmdhelp_cib_cibstatus"><span class="monospaced">cibstatus</span></h4>
<div class="paragraph"><p>Enter edit and manage the CIB status section level. See the
<a href="#cmdhelp_cibstatus">CIB status management section</a>.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_commit"><span class="monospaced">commit</span></h4>
<div class="paragraph"><p>Apply a shadow CIB to the cluster. If the shadow name is omitted
then the current shadow CIB is applied.</p></div>
<div class="paragraph"><p>Temporary shadow CIBs are removed automatically on commit.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>commit [&lt;cib&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_delete"><span class="monospaced">delete</span></h4>
<div class="paragraph"><p>Delete an existing shadow CIB.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>delete &lt;cib&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_diff"><span class="monospaced">diff</span></h4>
<div class="paragraph"><p>Print differences between the current cluster configuration and
the active shadow CIB.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_import"><span class="monospaced">import</span></h4>
<div class="paragraph"><p>At times it may be useful to create a shadow file from the
existing CIB. The CIB may be specified as file or as a PE input
file number. The shell will look up files in the local directory
first and then in the PE directory (typically <span class="monospaced">/var/lib/pengine</span>).
Once the CIB file is found, it is copied to a shadow and this
shadow is immediately available for use at both <span class="monospaced">configure</span> and
<span class="monospaced">cibstatus</span> levels.</p></div>
<div class="paragraph"><p>If the shadow name is omitted then the target shadow is named
after the input CIB file.</p></div>
<div class="paragraph"><p>Note that there are often more than one PE input file, so you may
need to specify the full name.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>import {&lt;file&gt;|&lt;number&gt;} [&lt;shadow&gt;]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>import pe-warn-2222
import 2289 issue2</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_list"><span class="monospaced">list</span></h4>
<div class="paragraph"><p>List existing shadow CIBs.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>list</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_new"><span class="monospaced">new</span></h4>
<div class="paragraph"><p>Create a new shadow CIB. The live cluster configuration and
status is copied to the shadow CIB.</p></div>
<div class="paragraph"><p>If the name of the shadow is omitted, we create a temporary CIB
shadow. It is useful if multiple level sessions are desired
without affecting the cluster. A temporary CIB shadow is short
lived and will be removed either on <span class="monospaced">commit</span> or on program exit.
Note that if the temporary shadow is not committed all changes in
the temporary shadow are lost.</p></div>
<div class="paragraph"><p>Specify <span class="monospaced">withstatus</span> if you want to edit the status section of
the shadow CIB (see the <a href="#cmdhelp_cibstatus">cibstatus section</a>).
Add <span class="monospaced">force</span> to force overwriting the existing shadow CIB.</p></div>
<div class="paragraph"><p>To start with an empty configuration that is not copied from the live
CIB, specify the <span class="monospaced">empty</span> keyword. (This also allows a shadow CIB to be
created in case no cluster is running.)</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>new [&lt;cib&gt;] [withstatus] [force] [empty]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_reset"><span class="monospaced">reset</span></h4>
<div class="paragraph"><p>Copy the current cluster configuration into the shadow CIB.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>reset &lt;cib&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cib_use"><span class="monospaced">use</span></h4>
<div class="paragraph"><p>Choose a CIB source. If you want to edit the status from the
shadow CIB specify <span class="monospaced">withstatus</span> (see <a href="#cmdhelp_cibstatus"><span class="monospaced">cibstatus</span></a>).
Leave out the CIB name to switch to the running CIB.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>use [&lt;cib&gt;] [withstatus]</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_ra"><span class="monospaced">ra</span> - Resource Agents (RA) lists and documentation</h3>
<div class="paragraph"><p>This level contains commands which show various information about
the installed resource agents. It is available both at the top
level and at the <span class="monospaced">configure</span> level.</p></div>
<div class="sect3">
<h4 id="cmdhelp_ra_classes"><span class="monospaced">classes</span></h4>
<div class="paragraph"><p>Print all resource agents' classes and, where appropriate, a list
of available providers.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>classes</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_ra_info"><span class="monospaced">info</span> (<span class="monospaced">meta</span>)</h4>
<div class="paragraph"><p>Show the meta-data of a resource agent type. This is where users
can find information on how to use a resource agent. It is also
possible to get information from some programs: <span class="monospaced">pengine</span>,
<span class="monospaced">crmd</span>, <span class="monospaced">cib</span>, and <span class="monospaced">stonithd</span>. Just specify the program name
instead of an RA.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>info [&lt;class&gt;:[&lt;provider&gt;:]]&lt;type&gt;
info &lt;type&gt; &lt;class&gt; [&lt;provider&gt;] (obsolete)</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>info apache
info ocf:pacemaker:Dummy
info stonith:ipmilan
info pengine</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_ra_list"><span class="monospaced">list</span></h4>
<div class="paragraph"><p>List available resource agents for the given class. If the class
is <span class="monospaced">ocf</span>, supply a provider to get agents which are available
only from that provider.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>list &lt;class&gt; [&lt;provider&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>list ocf pacemaker</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_ra_providers"><span class="monospaced">providers</span></h4>
<div class="paragraph"><p>List providers for a resource agent type. The class parameter
defaults to <span class="monospaced">ocf</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>providers &lt;type&gt; [&lt;class&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>providers apache</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_ra_validate"><span class="monospaced">validate</span></h4>
<div class="paragraph"><p>If the resource agent supports the <span class="monospaced">validate-all</span> action, this calls
the action with the given parameters, printing any warnings or errors
reported by the agent.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>validate &lt;agent&gt; [&lt;key&gt;=&lt;value&gt; ...]</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_resource"><span class="monospaced">resource</span> - Resource management</h3>
<div class="paragraph"><p>At this level resources may be managed.</p></div>
<div class="paragraph"><p>All (or almost all) commands are implemented with the CRM tools
such as <span class="monospaced">crm_resource(8)</span>.</p></div>
<div class="sect3">
<h4 id="cmdhelp_resource_ban"><span class="monospaced">ban</span></h4>
<div class="paragraph"><p>Ban a resource from running on a certain node. If no node is given
as argument, the resource is banned from the current location.</p></div>
<div class="paragraph"><p>See <span class="monospaced">move</span> for details on other arguments.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ban &lt;rsc&gt; [&lt;node&gt;] [&lt;lifetime&gt;] [force]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_cleanup"><span class="monospaced">cleanup</span></h4>
<div class="paragraph"><p>Cleanup resource status. Typically done after the resource has
temporarily failed. If a node is omitted, cleanup on all nodes.
If there are many nodes, the command may take a while.</p></div>
<div class="paragraph"><p><span class="monospaced">(Pacemaker 1.1.14)</span> Pass force to cleanup the resource itself,
otherwise the cleanup command will apply to the parent resource (if
any).</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>cleanup &lt;rsc&gt; [&lt;node&gt;] [force]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_clear"><span class="monospaced">clear</span> (<span class="monospaced">unmove</span>, <span class="monospaced">unmigrate</span>, <span class="monospaced">unban</span>)</h4>
<div class="paragraph"><p>Remove any relocation constraint created by
the <span class="monospaced">move</span>, <span class="monospaced">migrate</span> or <span class="monospaced">ban</span> command.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>clear &lt;rsc&gt;
unmigrate &lt;rsc&gt;
unban &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_constraints"><span class="monospaced">constraints</span></h4>
<div class="paragraph"><p>Display the location and colocation constraints affecting the
resource.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>constraints &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_demote"><span class="monospaced">demote</span></h4>
<div class="paragraph"><p>Demote a master-slave resource using the <span class="monospaced">target-role</span>
attribute.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>demote &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_failcount"><span class="monospaced">failcount</span></h4>
<div class="paragraph"><p>Show/edit/delete the failcount of a resource.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>failcount &lt;rsc&gt; set &lt;node&gt; &lt;value&gt;
failcount &lt;rsc&gt; delete &lt;node&gt;
failcount &lt;rsc&gt; show &lt;node&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>failcount fs_0 delete node2</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_locate"><span class="monospaced">locate</span></h4>
<div class="paragraph"><p>Show the current location of one or more resources.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>locate [&lt;rsc&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_maintenance"><span class="monospaced">maintenance</span></h4>
<div class="paragraph"><p>Enables or disables the per-resource maintenance mode. When this mode
is enabled, no monitor operations will be triggered for the resource.
<span class="monospaced">maintenance</span> attribute conflicts with the <span class="monospaced">is-managed</span>. When setting
the <span class="monospaced">maintenance</span> attribute, the user is proposed to remove the
<span class="monospaced">is-managed</span> attribute if it exists.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>maintenance &lt;resource&gt; [on|off|true|false]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>maintenance rsc1
maintenance rsc2 off</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_manage"><span class="monospaced">manage</span></h4>
<div class="paragraph"><p>Manage a resource using the <span class="monospaced">is-managed</span> attribute. If there
are multiple meta attributes sets, the attribute is set in all of
them. If the resource is a clone, all <span class="monospaced">is-managed</span> attributes are
removed from the children resources.
<span class="monospaced">is-managed</span> attribute conflicts with the <span class="monospaced">maintenance</span>. When setting
the <span class="monospaced">is-managed</span> attribute, the user is proposed to remove the
<span class="monospaced">maintenance</span> attribute if it exists.</p></div>
<div class="paragraph"><p>For details on group management see <a href="#cmdhelp_options_manage-children"><span class="monospaced">options manage-children</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>manage &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_meta"><span class="monospaced">meta</span></h4>
<div class="paragraph"><p>Show/edit/delete a meta attribute of a resource. Currently, all
meta attributes of a resource may be managed with other commands
such as <span class="monospaced">resource stop</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>meta &lt;rsc&gt; set &lt;attr&gt; &lt;value&gt;
meta &lt;rsc&gt; delete &lt;attr&gt;
meta &lt;rsc&gt; show &lt;attr&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>meta ip_0 set target-role stopped</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_move"><span class="monospaced">move</span> (<span class="monospaced">migrate</span>)</h4>
<div class="paragraph"><p>Move a resource away from its current location.</p></div>
<div class="paragraph"><p>If the destination node is left out, the resource is migrated by
creating a constraint which prevents it from running on the current
node. For this type of constraint to be created, the <span class="monospaced">force</span> argument
is required.</p></div>
<div class="paragraph"><p>A lifetime may be given for the constraint. Once it expires, the
location constraint will no longer be active.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>move &lt;rsc&gt; [&lt;node&gt;] [&lt;lifetime&gt;] [force]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_operations"><span class="monospaced">operations</span></h4>
<div class="paragraph"><p>Show active operations, optionally filtered by resource and node.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>operations [&lt;rsc&gt;] [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_param"><span class="monospaced">param</span></h4>
<div class="paragraph"><p>Show/edit/delete a parameter of a resource.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>param &lt;rsc&gt; set &lt;param&gt; &lt;value&gt;
param &lt;rsc&gt; delete &lt;param&gt;
param &lt;rsc&gt; show &lt;param&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>param ip_0 show ip</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_promote"><span class="monospaced">promote</span></h4>
<div class="paragraph"><p>Promote a master-slave resource using the <span class="monospaced">target-role</span>
attribute.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>promote &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_refresh"><span class="monospaced">refresh</span></h4>
<div class="paragraph"><p>Refresh CIB from the LRM status.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph"><p><span class="monospaced">refresh</span> has been deprecated and is now
an alias for <span class="monospaced">cleanup</span>.</p></div>
</div></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>refresh [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_reprobe"><span class="monospaced">reprobe</span></h4>
<div class="paragraph"><p>Probe for resources not started by the CRM.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph"><p><span class="monospaced">reprobe</span> has been deprecated and is now
an alias for <span class="monospaced">cleanup</span>.</p></div>
</div></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>reprobe [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_restart"><span class="monospaced">restart</span></h4>
<div class="paragraph"><p>Restart one or more resources. This is essentially a shortcut for
resource stop followed by a start. The shell is first going to wait
for the stop to finish, that is for all resources to really stop, and
only then to order the start action. Due to this command
entailing a whole set of operations, informational messages are
printed to let the user see some progress.</p></div>
<div class="paragraph"><p>For details on group management see
<a href="#cmdhelp_options_manage-children"><span class="monospaced">options manage-children</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>restart &lt;rsc&gt; [&lt;rsc&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># crm resource restart g_webserver
INFO: ordering g_webserver to stop
waiting for stop to finish .... done
INFO: ordering g_webserver to start
#</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_scores"><span class="monospaced">scores</span></h4>
<div class="paragraph"><p>Display the allocation scores for all resources.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>scores</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_secret"><span class="monospaced">secret</span></h4>
<div class="paragraph"><p>Sensitive parameters can be kept in local files rather than CIB
in order to prevent accidental data exposure. Use the <span class="monospaced">secret</span>
command to manage such parameters. <span class="monospaced">stash</span> and <span class="monospaced">unstash</span> move the
value from the CIB and back to the CIB respectively. The <span class="monospaced">set</span>
subcommand sets the parameter to the provided value. <span class="monospaced">delete</span>
removes the parameter completely. <span class="monospaced">show</span> displays the value of
the parameter from the local file. Use <span class="monospaced">check</span> to verify if the
local file content is valid.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>secret &lt;rsc&gt; set &lt;param&gt; &lt;value&gt;
secret &lt;rsc&gt; stash &lt;param&gt;
secret &lt;rsc&gt; unstash &lt;param&gt;
secret &lt;rsc&gt; delete &lt;param&gt;
secret &lt;rsc&gt; show &lt;param&gt;
secret &lt;rsc&gt; check &lt;param&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>secret fence_1 show password
secret fence_1 stash password
secret fence_1 set password secret_value</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_start"><span class="monospaced">start</span></h4>
<div class="paragraph"><p>Start one or more resources by setting the <span class="monospaced">target-role</span> attribute. If
there are multiple meta attributes sets, the attribute is set in all
of them. If the resource is a clone, all <span class="monospaced">target-role</span> attributes are
removed from the children resources.</p></div>
<div class="paragraph"><p>For details on group management see
<a href="#cmdhelp_options_manage-children"><span class="monospaced">options manage-children</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>start &lt;rsc&gt; [&lt;rsc&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_status"><span class="monospaced">status</span> (<span class="monospaced">show</span>, <span class="monospaced">list</span>)</h4>
<div class="paragraph"><p>Print resource status. More than one resource can be shown at once. If
the resource parameter is left out, the status of all resources is
printed.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status [&lt;rsc&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_stop"><span class="monospaced">stop</span></h4>
<div class="paragraph"><p>Stop one or more resources using the <span class="monospaced">target-role</span> attribute. If there
are multiple meta attributes sets, the attribute is set in all of
them. If the resource is a clone, all <span class="monospaced">target-role</span> attributes are
removed from the children resources.</p></div>
<div class="paragraph"><p>For details on group management see
<a href="#cmdhelp_options_manage-children"><span class="monospaced">options manage-children</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>stop &lt;rsc&gt; [&lt;rsc&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_trace"><span class="monospaced">trace</span></h4>
<div class="paragraph"><p>Start tracing RA for the given operation. The trace files are
stored in <span class="monospaced">$HA_VARLIB/trace_ra</span>. If the operation to be traced is
monitor, note that the number of trace files can grow very
quickly.</p></div>
<div class="paragraph"><p>If no operation name is given, crmsh will attempt to trace all
operations for the RA. This includes any configured operations, start
and stop as well as promote/demote for multistate resources.</p></div>
<div class="paragraph"><p>To trace the probe operation which exists for all resources, either
set a trace for <span class="monospaced">monitor</span> with interval <span class="monospaced">0</span>, or use <span class="monospaced">probe</span> as the
operation name.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>trace &lt;rsc&gt; [&lt;op&gt; [&lt;interval&gt;] ]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>trace fs start
trace webserver
trace webserver probe
trace fs monitor 0</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_unmanage"><span class="monospaced">unmanage</span></h4>
<div class="paragraph"><p>Unmanage a resource using the <span class="monospaced">is-managed</span> attribute. If there
are multiple meta attributes sets, the attribute is set in all of
them. If the resource is a clone, all <span class="monospaced">is-managed</span> attributes are
removed from the children resources.</p></div>
<div class="paragraph"><p>For details on group management see <a href="#cmdhelp_options_manage-children"><span class="monospaced">options manage-children</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>unmanage &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_untrace"><span class="monospaced">untrace</span></h4>
<div class="paragraph"><p>Stop tracing RA for the given operation. If no operation name is
given, crmsh will attempt to stop tracing all operations in resource.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>untrace &lt;rsc&gt; [&lt;op&gt; [&lt;interval&gt;] ]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>untrace fs start
untrace webserver</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_resource_utilization"><span class="monospaced">utilization</span></h4>
<div class="paragraph"><p>Show/edit/delete a utilization attribute of a resource. These
attributes describe hardware requirements. By setting the
<span class="monospaced">placement-strategy</span> cluster property appropriately, it is
possible then to distribute resources based on resource
requirements and node size. See also <a href="#cmdhelp_node_utilization">node utilization attributes</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>utilization &lt;rsc&gt; set &lt;attr&gt; &lt;value&gt;
utilization &lt;rsc&gt; delete &lt;attr&gt;
utilization &lt;rsc&gt; show &lt;attr&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>utilization xen1 set memory 4096</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_node"><span class="monospaced">node</span> - Node management</h3>
<div class="paragraph"><p>Node management and status commands.</p></div>
<div class="sect3">
<h4 id="cmdhelp_node_attribute"><span class="monospaced">attribute</span></h4>
<div class="paragraph"><p>Edit node attributes. This kind of attribute should refer to
relatively static properties, such as memory size.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>attribute &lt;node&gt; set &lt;attr&gt; &lt;value&gt;
attribute &lt;node&gt; delete &lt;attr&gt;
attribute &lt;node&gt; show &lt;attr&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>attribute node_1 set memory_size 4096</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_clearstate"><span class="monospaced">clearstate</span></h4>
<div class="paragraph"><p>Resets and clears the state of the specified node. This node is
afterwards assumed clean and offline. This command can be used to
manually confirm that a node has been fenced (e.g., powered off).</p></div>
<div class="paragraph"><p>Be careful! This can cause data corruption if you confirm that a node is
down that is, in fact, not cleanly down - the cluster will proceed as if
the fence had succeeded, possibly starting resources multiple times.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>clearstate &lt;node&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_delete"><span class="monospaced">delete</span></h4>
<div class="paragraph"><p>Delete a node. This command will remove the node from the CIB
and, in case the cluster stack is running, use the appropriate
program (<span class="monospaced">crm_node</span> or <span class="monospaced">hb_delnode</span>) to remove the node from the
membership.</p></div>
<div class="paragraph"><p>If the node is still listed as active and a member of our
partition we refuse to remove it. With the global force option
(<span class="monospaced">-F</span>) we will try to delete the node anyway.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>delete &lt;node&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_fence"><span class="monospaced">fence</span></h4>
<div class="paragraph"><p>Make CRM fence a node. This functionality depends on stonith
resources capable of fencing the specified node. No such stonith
resources, no fencing will happen.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>fence &lt;node&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_maintenance"><span class="monospaced">maintenance</span></h4>
<div class="paragraph"><p>Set the node status to maintenance. This is equivalent to the
cluster-wide <span class="monospaced">maintenance-mode</span> property but puts just one node
into the maintenance mode. If there are maintenaned resources on
the node, the user will be proposed to remove the maintenance
property from them.</p></div>
<div class="paragraph"><p>The node parameter defaults to the node where the command is run.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>maintenance [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_online"><span class="monospaced">online</span></h4>
<div class="paragraph"><p>Set a node to online status.</p></div>
<div class="paragraph"><p>The node parameter defaults to the node where the command is run.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>online [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_ready"><span class="monospaced">ready</span></h4>
<div class="paragraph"><p>Set the node&#8217;s maintenance status to <span class="monospaced">off</span>. The node should be
now again fully operational and capable of running resource
operations.</p></div>
<div class="paragraph"><p>The node parameter defaults to the node where the command is run.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ready [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_server"><span class="monospaced">server</span></h4>
<div class="paragraph"><p>Remote nodes may have a configured server address which should
be used when contacting the node. This command prints the
server address if configured, else the node name.</p></div>
<div class="paragraph"><p>If no parameter is given, the addresses or names for all nodes
are printed.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>server [&lt;node&gt; ...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Show a node definition. If the node parameter is omitted then all
nodes are shown.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_standby"><span class="monospaced">standby</span></h4>
<div class="paragraph"><p>Set a node to standby status. The node parameter defaults to the
node where the command is run.</p></div>
<div class="paragraph"><p>Additionally, you may specify a lifetime for the standby---if set to
<span class="monospaced">reboot</span>, the node will be back online once it reboots. <span class="monospaced">forever</span> will
keep the node in standby after reboot. The life time defaults to
<span class="monospaced">forever</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>standby [&lt;node&gt;] [&lt;lifetime&gt;]

lifetime :: reboot | forever</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>standby bob reboot</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_status"><span class="monospaced">status</span></h4>
<div class="paragraph"><p>Show nodes' status as XML. If the node parameter is omitted then
all nodes are shown.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status [&lt;node&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_status-attr"><span class="monospaced">status-attr</span></h4>
<div class="paragraph"><p>Edit node attributes which are in the CIB status section, i.e.
attributes which hold properties of a more volatile nature. One
typical example is attribute generated by the <span class="monospaced">pingd</span> utility.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status-attr &lt;node&gt; set &lt;attr&gt; &lt;value&gt;
status-attr &lt;node&gt; delete &lt;attr&gt;
status-attr &lt;node&gt; show &lt;attr&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>status-attr node_1 show pingd</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_node_utilization"><span class="monospaced">utilization</span></h4>
<div class="paragraph"><p>Edit node utilization attributes. These attributes describe
hardware characteristics as integer numbers such as memory size
or the number of CPUs. By setting the <span class="monospaced">placement-strategy</span>
cluster property appropriately, it is possible then to distribute
resources based on resource requirements and node size. See also
<a href="#cmdhelp_resource_utilization">resource utilization attributes</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>utilization &lt;node&gt; set &lt;attr&gt; &lt;value&gt;
utilization &lt;node&gt; delete &lt;attr&gt;
utilization &lt;node&gt; show &lt;attr&gt;</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>utilization node_1 set memory 16384
utilization node_1 show cpu</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_site"><span class="monospaced">site</span> - GEO clustering site support</h3>
<div class="paragraph"><p>A cluster may consist of two or more subclusters in different and
distant locations. This set of commands supports such setups.</p></div>
<div class="sect3">
<h4 id="cmdhelp_site_ticket"><span class="monospaced">ticket</span></h4>
<div class="paragraph"><p>Tickets are cluster-wide attributes. They can be managed at the
site where this command is executed.</p></div>
<div class="paragraph"><p>It is then possible to constrain resources depending on the
ticket availability (see the <a href="#cmdhelp_configure_rsc_ticket"><span class="monospaced">rsc_ticket</span></a> command
for more details).</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ticket {grant|revoke|standby|activate|show|time|delete} &lt;ticket&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ticket grant ticket1</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_options"><span class="monospaced">options</span> - User preferences</h3>
<div class="paragraph"><p>The user may set various options for the crm shell itself.</p></div>
<div class="sect3">
<h4 id="cmdhelp_options_add-quotes"><span class="monospaced">add-quotes</span></h4>
<div class="paragraph"><p>The shell (as in <span class="monospaced">/bin/sh</span>) parser strips quotes from the command
line. This may sometimes make it really difficult to type values
which contain white space. One typical example is the configure
filter command. The crm shell will supply extra quotes around
arguments which contain white space. The default is <span class="monospaced">yes</span>.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on quotes use</div>
<div class="paragraph"><p>Adding quotes around arguments automatically has been introduced
with version 1.2.2 and it is technically a regression. Being a
regression is the only reason the <span class="monospaced">add-quotes</span> option exists. If
you have custom shell scripts which would break, just set the
<span class="monospaced">add-quotes</span> option to <span class="monospaced">no</span>.</p></div>
<div class="paragraph"><p>For instance, with adding quotes enabled, it is possible to do
the following:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># crm configure primitive d1 Dummy \
    meta description="some description here"
# crm configure filter 'sed "s/hostlist=./&amp;node-c /"' fencing</pre>
</div></div>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_check-frequency"><span class="monospaced">check-frequency</span></h4>
<div class="paragraph"><p>Semantic check of the CIB or elements modified or created may be
done on every configuration change (<span class="monospaced">always</span>), when verifying
(<span class="monospaced">on-verify</span>) or <span class="monospaced">never</span>. It is by default set to <span class="monospaced">always</span>.
Experts may want to change the setting to <span class="monospaced">on-verify</span>.</p></div>
<div class="paragraph"><p>The checks require that resource agents are present. If they are
not installed at the configuration time set this preference to
<span class="monospaced">never</span>.</p></div>
<div class="paragraph"><p>See <a href="#topics_Features_Checks">Configuration semantic checks</a> for more details.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_check-mode"><span class="monospaced">check-mode</span></h4>
<div class="paragraph"><p>Semantic check of the CIB or elements modified or created may be
done in the <span class="monospaced">strict</span> mode or in the <span class="monospaced">relaxed</span> mode. In the former
certain problems are treated as configuration errors. In the
<span class="monospaced">relaxed</span> mode all are treated as warnings. The default is <span class="monospaced">strict</span>.</p></div>
<div class="paragraph"><p>See <a href="#topics_Features_Checks">Configuration semantic checks</a> for more details.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_colorscheme"><span class="monospaced">colorscheme</span></h4>
<div class="paragraph"><p>With <span class="monospaced">output</span> set to <span class="monospaced">color</span>, a comma separated list of colors
from this option are used to emphasize:</p></div>
<div class="ulist"><ul>
<li>
<p>
keywords
</p>
</li>
<li>
<p>
object ids
</p>
</li>
<li>
<p>
attribute names
</p>
</li>
<li>
<p>
attribute values
</p>
</li>
<li>
<p>
scores
</p>
</li>
<li>
<p>
resource references
</p>
</li>
</ul></div>
<div class="paragraph"><p><span class="monospaced">crm</span> can show colors only if there is curses support for python
installed (usually provided by the <span class="monospaced">python-curses</span> package). The
colors are whatever is available in your terminal. Use <span class="monospaced">normal</span>
if you want to keep the default foreground color.</p></div>
<div class="paragraph"><p>This user preference defaults to
<span class="monospaced">yellow,normal,cyan,red,green,magenta</span> which is good for
terminals with dark background. You may want to change the color
scheme and save it in the preferences file for other color
setups.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>colorscheme yellow,normal,blue,red,green,magenta</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_editor"><span class="monospaced">editor</span></h4>
<div class="paragraph"><p>The <span class="monospaced">edit</span> command invokes an editor. Use this to specify your
preferred editor program. If not set, it will default to either
the value of the <span class="monospaced">EDITOR</span> environment variable or to one of the
standard UNIX editors (<span class="monospaced">vi</span>,<span class="monospaced">emacs</span>,<span class="monospaced">nano</span>).</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>editor program</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>editor vim</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_manage-children"><span class="monospaced">manage-children</span></h4>
<div class="paragraph"><p>Some resource management commands, such as <span class="monospaced">resource stop</span>, when
the target resource is a group, may not always produce desired
result. Each element, group and the primitive members, can have a
meta attribute and those attributes may end up with conflicting
values. Consider the following construct:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)# configure show svc fs virtual-ip
primitive fs Filesystem \
    params device="/dev/drbd0" directory="/srv/nfs" fstype=ext3 \
    op monitor interval=10s \
    meta target-role=Started
primitive virtual-ip IPaddr2 \
    params ip=10.2.13.110 iflabel=1 \
    op monitor interval=10s \
    op start interval=0 \
    meta target-role=Started
group svc fs virtual-ip \
    meta target-role=Stopped</pre>
</div></div>
<div class="paragraph"><p>Even though the element <span class="monospaced">svc</span> should be stopped, the group is
actually running because all its members have the <span class="monospaced">target-role</span>
set to <span class="monospaced">Started</span>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)# resource show svc
resource svc is running on: xen-f</pre>
</div></div>
<div class="paragraph"><p>Hence, if the user invokes <span class="monospaced">resource stop svc</span> the intention is
not clear. This preference gives the user an opportunity to
better control what happens if attributes of group members have
values which are in conflict with the same attribute of the group
itself.</p></div>
<div class="paragraph"><p>Possible values are <span class="monospaced">ask</span> (the default), <span class="monospaced">always</span>, and <span class="monospaced">never</span>.
If set to <span class="monospaced">always</span>, the crm shell removes all children attributes
which have values different from the parent. If set to <span class="monospaced">never</span>,
all children attributes are left intact. Finally, if set to
<span class="monospaced">ask</span>, the user will be asked for each member what is to be done.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_output"><span class="monospaced">output</span></h4>
<div class="paragraph"><p><span class="monospaced">crm</span> can adorn configurations in two ways: in color (similar to
for instance the <span class="monospaced">ls --color</span> command) and by showing keywords in
upper case. Possible values are <span class="monospaced">plain</span>, <span class="monospaced">color-always</span>, <span class="monospaced">color</span>,
and <em>uppercase</em>. It is possible to combine <span class="monospaced">uppercase</span> with one
of the color values in order to get an upper case xmass tree. Just
set this option to <span class="monospaced">color,uppercase</span> or <span class="monospaced">color-always,uppercase</span>.
In case you need color codes in pipes, <span class="monospaced">color-always</span> forces color
codes even in case the terminal is not a tty (just like <span class="monospaced">ls
--color=always</span>).</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_pager"><span class="monospaced">pager</span></h4>
<div class="paragraph"><p>The <span class="monospaced">view</span> command displays text through a pager. Use this to
specify your preferred pager program. If not set, it will default
to either the value of the <span class="monospaced">PAGER</span> environment variable or to one
of the standard UNIX system pagers (<span class="monospaced">less</span>,<span class="monospaced">more</span>,<span class="monospaced">pg</span>).</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_reset"><span class="monospaced">reset</span></h4>
<div class="paragraph"><p>This command resets all user options to the defaults. If used as
a single-shot command, the rc file (<span class="monospaced">$HOME/.config/crm/rc</span>) is
reset to the defaults too.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_save"><span class="monospaced">save</span></h4>
<div class="paragraph"><p>Save current settings to the rc file (<span class="monospaced">$HOME/.config/crm/rc</span>). On
further <span class="monospaced">crm</span> runs, the rc file is automatically read and parsed.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_set"><span class="monospaced">set</span></h4>
<div class="paragraph"><p>Sets the value of an option. Takes the fully qualified
name of the option as argument, as displayed by <span class="monospaced">show all</span>.</p></div>
<div class="paragraph"><p>The modified option value is stored in the user-local
configuration file, usually found in <span class="monospaced">~/.config/crm/crm.conf</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>set &lt;option&gt; &lt;value&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>set color.warn "magenta bold"
set editor nano</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Display all current settings.</p></div>
<div class="paragraph"><p>Given an option name as argument, <span class="monospaced">show</span> will display only the value
of that argument.</p></div>
<div class="paragraph"><p>Given <span class="monospaced">all</span> as argument, <span class="monospaced">show</span> displays all available user options.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show [all|&lt;option&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show
show skill-level
show all</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_skill-level"><span class="monospaced">skill-level</span></h4>
<div class="paragraph"><p>Based on the skill-level setting, the user is allowed to use only
a subset of commands. There are three levels: operator,
administrator, and expert. The operator level allows only
commands at the <span class="monospaced">resource</span> and <span class="monospaced">node</span> levels, but not editing
or deleting resources. The administrator may do that and may also
configure the cluster at the <span class="monospaced">configure</span> level and manage the
shadow CIBs. The expert may do all.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>skill-level &lt;level&gt;

level :: operator | administrator | expert</pre>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on security</div>
<div class="paragraph"><p>The <span class="monospaced">skill-level</span> option is advisory only. There is nothing
stopping any users change their skill level (see
<a href="#topics_Features_Security">Access Control Lists (ACL)</a> on how to enforce
access control).</p></div>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_sort-elements"><span class="monospaced">sort-elements</span></h4>
<div class="paragraph"><p><span class="monospaced">crm</span> by default sorts CIB elements. If you want them appear in
the order they were created, set this option to <span class="monospaced">no</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>sort-elements {yes|no}</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>sort-elements no</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_user"><span class="monospaced">user</span></h4>
<div class="paragraph"><p>Sufficient privileges are necessary in order to manage a
cluster: programs such as <span class="monospaced">crm_verify</span> or <span class="monospaced">crm_resource</span> and,
ultimately, <span class="monospaced">cibadmin</span> have to be run either as <span class="monospaced">root</span> or as the
CRM owner user (typically <span class="monospaced">hacluster</span>). You don&#8217;t have to worry
about that if you run <span class="monospaced">crm</span> as <span class="monospaced">root</span>. A more secure way is to
run the program with your usual privileges, set this option to
the appropriate user (such as <span class="monospaced">hacluster</span>), and setup the
<span class="monospaced">sudoers</span> file.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>user system-user</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>user hacluster</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_options_wait"><span class="monospaced">wait</span></h4>
<div class="paragraph"><p>In normal operation, <span class="monospaced">crm</span> runs a command and gets back
immediately to process other commands or get input from the user.
With this option set to <span class="monospaced">yes</span> it will wait for the started
transition to finish. In interactive mode dots are printed to
indicate progress.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>wait {yes|no}</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>wait yes</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_configure"><span class="monospaced">configure</span> - CIB configuration</h3>
<div class="paragraph"><p>This level enables all CIB object definition commands.</p></div>
<div class="paragraph"><p>The configuration may be logically divided into four parts:
nodes, resources, constraints, and (cluster) properties and
attributes.  Each of these commands support one or more basic CIB
objects.</p></div>
<div class="paragraph"><p>Nodes and attributes describing nodes are managed using the
<span class="monospaced">node</span> command.</p></div>
<div class="paragraph"><p>Commands for resources are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">primitive</span>
</p>
</li>
<li>
<p>
<span class="monospaced">monitor</span>
</p>
</li>
<li>
<p>
<span class="monospaced">group</span>
</p>
</li>
<li>
<p>
<span class="monospaced">clone</span>
</p>
</li>
<li>
<p>
<span class="monospaced">ms</span>/<span class="monospaced">master</span> (master-slave)
</p>
</li>
</ul></div>
<div class="paragraph"><p>In order to streamline large configurations, it is possible to
define a template which can later be referenced in primitives:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">rsc_template</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>In that case the primitive inherits all attributes defined in the
template.</p></div>
<div class="paragraph"><p>There are three types of constraints:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">location</span>
</p>
</li>
<li>
<p>
<span class="monospaced">colocation</span>
</p>
</li>
<li>
<p>
<span class="monospaced">order</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>It is possible to define fencing order (stonith resource
priorities):</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">fencing_topology</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Finally, there are the cluster properties, resource meta
attributes defaults, and operations defaults. All are just a set
of attributes. These attributes are managed by the following
commands:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">property</span>
</p>
</li>
<li>
<p>
<span class="monospaced">rsc_defaults</span>
</p>
</li>
<li>
<p>
<span class="monospaced">op_defaults</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>In addition to the cluster configuration, the Access Control
Lists (ACL) can be setup to allow access to parts of the CIB for
users other than <span class="monospaced">root</span> and <span class="monospaced">hacluster</span>. The following commands
manage ACL:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">user</span>
</p>
</li>
<li>
<p>
<span class="monospaced">role</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>In Pacemaker 1.1.12 and up, this command replaces the <span class="monospaced">user</span> command
for handling ACLs:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">acl_target</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The changes are applied to the current CIB only on ending the
configuration session or using the <span class="monospaced">commit</span> command.</p></div>
<div class="paragraph"><p>Comments start with <span class="monospaced">#</span> in the first line. The comments are tied
to the element which follows. If the element moves, its comments
will follow.</p></div>
<div class="sect3">
<h4 id="cmdhelp_configure_acl_target"><span class="monospaced">acl_target</span></h4>
<div class="paragraph"><p>Defines an ACL target.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>acl_target &lt;tid&gt; [&lt;role&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>acl_target joe resource_admin constraint_editor</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_alert"><span class="monospaced">alert</span></h4>
<div class="sidebarblock">
<div class="content">
<div class="title">Version note</div>
<div class="paragraph"><p>This feature is only available
in Pacemaker 1.1.15+.</p></div>
</div></div>
<div class="paragraph"><p>Event-driven alerts enables calling scripts whenever interesting
events occur in the cluster (nodes joining or leaving, resources
starting or stopping, etc.).</p></div>
<div class="paragraph"><p>The <span class="monospaced">path</span> is an arbitrary file path to an alert script.  Existing
external scripts used with ClusterMon resources can be used as alert
scripts, since the interface is compatible.</p></div>
<div class="paragraph"><p>Each alert may have a number of receipients configured.  These will be
passed to the script as arguments. The first recipient will also be
passed as the <span class="monospaced">CRM_alert_recipient</span> environment variable, for
compatibility with existing scripts that only support one recipient.</p></div>
<div class="paragraph"><p>The available meta attributes are <span class="monospaced">timeout</span> (default 30s) and
<span class="monospaced">timestamp-format</span> (default <span class="monospaced">"%H:%M:%S.%06N"</span>).</p></div>
<div class="paragraph"><p>Some configurations may require each recipient to be delimited by
brackets, to avoid ambiguity. In the example <span class="monospaced">alert-2</span> below, the meta
attribute for <span class="monospaced">timeout</span> is defined after the recipient, so the
brackets are used to ensure that the meta attribute is set for the
alert and not just the recipient. This can be avoided by setting any
alert attributes before defining the recipients.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>alert &lt;id&gt; &lt;path&gt; \
  [attributes &lt;nvpair&gt; ...] \
  [meta &lt;nvpair&gt; ...] \
  [to [{] &lt;recipient&gt;
    [attributes &lt;nvpair&gt; ...] \
    [meta &lt;nvpair&gt; ...] [}] \
    ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>alert alert-1 /srv/pacemaker/pcmk_alert_sample.sh \
    to /var/log/cluster-alerts.log

alert alert-2 /srv/pacemaker/example_alert.sh \
    meta timeout=60s \
    to { /var/log/cluster-alerts.log }</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_cib"><span class="monospaced">cib</span></h4>
<div class="paragraph"><p>This level is for management of shadow CIBs. It is available at
the <span class="monospaced">configure</span> level to enable saving intermediate changes to a
shadow CIB instead of to the live cluster. This short excerpt
shows how:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# cib new test-2
INFO: test-2 shadow CIB created
crm(test-2)configure# commit</pre>
</div></div>
<div class="paragraph"><p>Note how the current CIB in the prompt changed from <span class="monospaced">live</span> to
<span class="monospaced">test-2</span> after issuing the <span class="monospaced">cib new</span> command. See also the
<a href="#cmdhelp_cib">CIB shadow management</a> for more information.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_cibstatus"><span class="monospaced">cibstatus</span></h4>
<div class="paragraph"><p>Enter edit and manage the CIB status section level. See the
<a href="#cmdhelp_cibstatus">CIB status management section</a>.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_clone"><span class="monospaced">clone</span></h4>
<div class="paragraph"><p>The <span class="monospaced">clone</span> command creates a resource clone. It may contain a
single primitive resource or one group of resources.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>clone &lt;name&gt; &lt;rsc&gt;
  [description=&lt;description&gt;]
  [meta &lt;attr_list&gt;]
  [params &lt;attr_list&gt;]

attr_list :: [$id=&lt;id&gt;] &lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] | $id-ref=&lt;id&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>clone cl_fence apc_1 \
  meta clone-node-max=1 globally-unique=false</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_colocation"><span class="monospaced">colocation</span> (<span class="monospaced">collocation</span>)</h4>
<div class="paragraph"><p>This constraint expresses the placement relation between two
or more resources. If there are more than two resources, then the
constraint is called a resource set.</p></div>
<div class="paragraph"><p>The score is used to indicate the priority of the constraint. A
positive score indicates that the resources should run on the same
node. A negative score that they should not run on the same
node. Values of positive or negative <span class="monospaced">infinity</span> indicate a mandatory
constraint.</p></div>
<div class="paragraph"><p>In the two resource form, the cluster will place <span class="monospaced">&lt;with-rsc&gt;</span> first,
and then decide where to put the <span class="monospaced">&lt;rsc&gt;</span> resource.</p></div>
<div class="paragraph"><p>Collocation resource sets have an extra attribute (<span class="monospaced">sequential</span>)
to allow for sets of resources which don&#8217;t depend on each other
in terms of state. The shell syntax for such sets is to put
resources in parentheses.</p></div>
<div class="paragraph"><p>Sets cannot be nested.</p></div>
<div class="paragraph"><p>The optional <span class="monospaced">node-attribute</span> can be used to colocate resources on a
set of nodes and not necessarily on the same node. For example, by
setting a node attribute <span class="monospaced">color</span> on all nodes and setting the
<span class="monospaced">node-attribute</span> value to <span class="monospaced">color</span> as well, the colocated resources
will be placed on any node that has the same color.</p></div>
<div class="paragraph"><p>For more details on how to configure resource sets, see
<a href="#topics_Features_Resourcesets"><span class="monospaced">Syntax: Resource sets</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>colocation &lt;id&gt; &lt;score&gt;: &lt;rsc&gt;[:&lt;role&gt;] &lt;with-rsc&gt;[:&lt;role&gt;]
  [node-attribute=&lt;node_attr&gt;]

colocation &lt;id&gt; &lt;score&gt;: &lt;resource_sets&gt;
  [node-attribute=&lt;node_attr&gt;]

resource_sets :: &lt;resource_set&gt; [&lt;resource_set&gt; ...]

resource_set :: ["("|"["] &lt;rsc&gt;[:&lt;role&gt;] [&lt;rsc&gt;[:&lt;role&gt;] ...] \
                [&lt;attributes&gt;]  [")"|"]"]

attributes :: [require-all=(true|false)] [sequential=(true|false)]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>colocation never_put_apache_with_dummy -inf: apache dummy
colocation c1 inf: A ( B C )</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_commit"><span class="monospaced">commit</span></h4>
<div class="paragraph"><p>Commit the current configuration to the CIB in use. As noted
elsewhere, commands in a configure session don&#8217;t have immediate
effect on the CIB. All changes are applied at one point in time,
either using <span class="monospaced">commit</span> or when the user leaves the configure
level. In case the CIB in use changed in the meantime, presumably
by somebody else, the crm shell will refuse to apply the changes.</p></div>
<div class="paragraph"><p>If you know that it&#8217;s fine to still apply them, add <span class="monospaced">force</span> to the
command line.</p></div>
<div class="paragraph"><p>To disable CIB patching and apply the changes by replacing the CIB
completely, add <span class="monospaced">replace</span> to the command line. Note that this can lead
to previous changes being overwritten if some other process
concurrently modifies the CIB.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>commit [force] [replace]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_default-timeouts"><span class="monospaced">default-timeouts</span></h4>
<div class="paragraph"><p>This command takes the timeouts from the actions section of the
resource agent meta-data and sets them for the operations of the
primitive.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>default-timeouts &lt;id&gt; [&lt;id&gt;...]</pre>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on <span class="monospaced">default-timeouts</span></div>
<div class="paragraph"><p>The use of this command is discouraged in favor of manually
determining the best timeouts required for the particular
configuration. Relying on the resource agent to supply appropriate
timeouts can cause the resource to fail at the worst possible moment.</p></div>
<div class="paragraph"><p>Appropriate timeouts for resource actions are context-sensitive, and
should be carefully considered with the whole configuration in mind.</p></div>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_delete"><span class="monospaced">delete</span></h4>
<div class="paragraph"><p>Delete one or more objects. If an object to be deleted belongs to
a container object, such as a group, and it is the only resource
in that container, then the container is deleted as well. Any
related constraints are removed as well.</p></div>
<div class="paragraph"><p>If the object is a started resource, it will not be deleted unless the
<span class="monospaced">--force</span> flag is passed to the command, or the <span class="monospaced">force</span> option is set.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>delete [--force] &lt;id&gt; [&lt;id&gt;...]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_edit"><span class="monospaced">edit</span></h4>
<div class="paragraph"><p>This command invokes the editor with the object description. As
with the <span class="monospaced">show</span> command, the user may choose to edit all objects
or a set of objects.</p></div>
<div class="paragraph"><p>If the user insists, he or she may edit the XML edition of the
object. If you do that, don&#8217;t modify any id attributes.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>edit [xml] [&lt;id&gt; ...]
edit [xml] changed</pre>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on renaming element ids</div>
<div class="paragraph"><p>The edit command sometimes cannot properly handle modifying
element ids. In particular for elements which belong to group or
ms resources. Group and ms resources themselves also cannot be
renamed. Please use the <span class="monospaced">rename</span> command instead.</p></div>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_erase"><span class="monospaced">erase</span></h4>
<div class="paragraph"><p>The <span class="monospaced">erase</span> clears all configuration. Apart from nodes. To remove
nodes, you have to specify an additional keyword <span class="monospaced">nodes</span>.</p></div>
<div class="paragraph"><p>Note that removing nodes from the live cluster may have some
strange/interesting/unwelcome effects.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>erase [nodes]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_fencing_topology"><span class="monospaced">fencing_topology</span></h4>
<div class="paragraph"><p>If multiple fencing (stonith) devices are available capable of
fencing a node, their order may be specified by <span class="monospaced">fencing_topology</span>.
The order is specified per node.</p></div>
<div class="paragraph"><p>Stonith resources can be separated by <span class="monospaced">,</span> in which case all of
them need to succeed. If they fail, the next stonith resource (or
set of resources) is used. In other words, use comma to separate
resources which all need to succeed and whitespace for serial
order. It is not allowed to use whitespace around comma.</p></div>
<div class="paragraph"><p>If the node is left out, the order is used for all nodes.
That should reduce the configuration size in some stonith setups.</p></div>
<div class="paragraph"><p>From Pacemaker version 1.1.14, it is possible to use a node attribute
as the <span class="monospaced">target</span> in a fencing topology. The syntax for this usage is
described below.</p></div>
<div class="paragraph"><p>From Pacemaker version 1.1.14, it is also possible to use regular
expression patterns as the <span class="monospaced">target</span> in a fencing topology. The configured
fencing sequence then applies to all devices matching the pattern.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>fencing_topology &lt;stonith_resources&gt; [&lt;stonith_resources&gt; ...]
fencing_topology &lt;fencing_order&gt; [&lt;fencing_order&gt; ...]

fencing_order :: &lt;target&gt; &lt;stonith_resources&gt; [&lt;stonith_resources&gt; ...]

stonith_resources :: &lt;rsc&gt;[,&lt;rsc&gt;...]
target :: &lt;node&gt;: | attr:&lt;node-attribute&gt;=&lt;value&gt; | pattern:&lt;pattern&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre># Only kill the power if poison-pill fails
fencing_topology poison-pill power

# As above for node-a, but a different strategy for node-b
fencing_topology \
    node-a: poison-pill power \
    node-b: ipmi serial

# Fencing anything on rack 1 requires fencing via both APC 1 and 2,
# to defeat the redundancy provided by two separate UPS units.
fencing_topology attr:rack=1 apc01,apc02

# Fencing for all machines named green.* is done using the pear
# fencing device first, while all machines named red.* are fenced
# using the apple fencing device first.
fencing_topology \
    pattern:green.* pear apple \
    pattern:red.* apple pear</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_filter"><span class="monospaced">filter</span></h4>
<div class="paragraph"><p>This command filters the given CIB elements through an external
program. The program should accept input on <span class="monospaced">stdin</span> and send
output to <span class="monospaced">stdout</span> (the standard UNIX filter conventions). As
with the <span class="monospaced">show</span> command, the user may choose to filter all or
just a subset of elements.</p></div>
<div class="paragraph"><p>It is possible to filter the XML representation of objects, but
probably not as useful as the configuration language. The
presentation is somewhat different from what would be displayed
by the <span class="monospaced">show</span> command---each element is shown on a single line,
i.e. there are no backslashes and no other embelishments.</p></div>
<div class="paragraph"><p>Don&#8217;t forget to put quotes around the filter if it contains
spaces.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>filter &lt;prog&gt; [xml] [&lt;id&gt; ...]
filter &lt;prog&gt; [xml] changed</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>filter "sed '/^primitive/s/target-role=[^ ]*//'"
# crm configure filter "sed '/^primitive/s/target-role=[^ ]*//'"
crm configure &lt;&lt;END
  filter "sed '/threshold=\"1\"/s/=\"1\"/=\"0\"/g'"
END</pre>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on quotation marks</div>
<div class="paragraph"><p>Filter commands which feature a blend of quotation marks can be
difficult to get right, especially when used directly from bash, since
bash does its own quotation parsing. In these cases, it can be easier
to supply the filter command as standard input. See the last example
above.</p></div>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_get_property"><span class="monospaced">get-property</span></h4>
<div class="paragraph"><p>Show the value of the given property. If the value is not set, the
command will print the default value for the property, if known.</p></div>
<div class="paragraph"><p>If no property name is passed to the command, the list of known
cluster properties is printed.</p></div>
<div class="paragraph"><p>If the property is set multiple times, for example using multiple
property sets with different rule expressions, the output of this
command is undefined.</p></div>
<div class="paragraph"><p>Pass the argument <span class="monospaced">-t</span> or <span class="monospaced">--true</span> to <span class="monospaced">get-property</span> to translate
the argument value into <span class="monospaced">true</span> or <span class="monospaced">false</span>. If the value is not
set, the command will print <span class="monospaced">false</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>get-property [-t|--true] [&lt;name&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>get-property stonith-enabled
get-property -t maintenance-mode</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_graph"><span class="monospaced">graph</span></h4>
<div class="paragraph"><p>Create a graphviz graphical layout from the current cluster
configuration.</p></div>
<div class="paragraph"><p>Currently, only <span class="monospaced">dot</span> (directed graph) is supported. It is
essentially a visualization of resource ordering.</p></div>
<div class="paragraph"><p>The graph may be saved to a file which can be used as source for
various graphviz tools (by default it is displayed in the user&#8217;s
X11 session). Optionally, by specifying the format, one can also
produce an image instead.</p></div>
<div class="paragraph"><p>For more or different graphviz attributes, it is possible to save
the default set of attributes to an ini file. If this file exists
it will always override the builtin settings. The <span class="monospaced">exportsettings</span>
subcommand also prints the location of the ini file.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>graph [&lt;gtype&gt; [&lt;file&gt; [&lt;img_format&gt;]]]
graph exportsettings

gtype :: dot
img_format :: `dot` output format (see the +-T+ option)</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>graph dot
graph dot clu1.conf.dot
graph dot clu1.conf.svg svg</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_group"><span class="monospaced">group</span></h4>
<div class="paragraph"><p>The <span class="monospaced">group</span> command creates a group of resources. This can be useful
when resources depend on other resources and require that those
resources start in order on the same node. A common use of resource
groups is to ensure that a server and a virtual IP are located
together, and that the virtual IP is started before the server.</p></div>
<div class="paragraph"><p>Grouped resources are started in the order they appear in the group,
and stopped in the reverse order. If a resource in the group cannot
run anywhere, resources following it in the group will not start.</p></div>
<div class="paragraph"><p><span class="monospaced">group</span> can be passed the "container" meta attribute, to indicate that
it is to be used to group VM resources monitored using Nagios. The
resource referred to by the container attribute must be of type
<span class="monospaced">ocf:heartbeat:Xen</span>, <span class="monospaced">ocf:heartbeat:VirtualDomain</span> or <span class="monospaced">ocf:heartbeat:lxc</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>group &lt;name&gt; &lt;rsc&gt; [&lt;rsc&gt;...]
  [description=&lt;description&gt;]
  [meta attr_list]
  [params attr_list]

attr_list :: [$id=&lt;id&gt;] &lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] | $id-ref=&lt;id&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>group internal_www disk0 fs0 internal_ip apache \
  meta target_role=stopped

group vm-and-services vm vm-sshd meta container="vm"</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_load"><span class="monospaced">load</span></h4>
<div class="paragraph"><p>Load a part of configuration (or all of it) from a local file or
a network URL. The <span class="monospaced">replace</span> method replaces the current
configuration with the one from the source. The <span class="monospaced">update</span> method
tries to import the contents into the current configuration. The
<span class="monospaced">push</span> method imports the contents into the current configuration
and removes any lines that are not present in the given
configuration.
The file may be a CLI file or an XML file.</p></div>
<div class="paragraph"><p>If the URL is <span class="monospaced">-</span>, the configuration is read from standard input.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>load [xml] &lt;method&gt; URL

method :: replace | update | push</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>load xml update myfirstcib.xml
load xml replace http://storage.big.com/cibs/bigcib.xml
load xml push smallcib.xml</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_location"><span class="monospaced">location</span></h4>
<div class="paragraph"><p><span class="monospaced">location</span> defines the preference of nodes for the given
resource. The location constraints consist of one or more rules
which specify a score to be awarded if the rule matches.</p></div>
<div class="paragraph"><p>The resource referenced by the location constraint can be one of the
following:</p></div>
<div class="ulist"><ul>
<li>
<p>
Plain resource reference: <span class="monospaced">location loc1 webserver 100: node1</span>
</p>
</li>
<li>
<p>
Resource set in curly brackets: <span class="monospaced">location loc1 { virtual-ip webserver } 100: node1</span>
</p>
</li>
<li>
<p>
Tag containing resource ids: <span class="monospaced">location loc1 tag1 100: node1</span>
</p>
</li>
<li>
<p>
Resource pattern: <span class="monospaced">location loc1 /web.*/ 100: node1</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <span class="monospaced">resource-discovery</span> attribute allows probes to be selectively
enabled or disabled per resource and node.</p></div>
<div class="paragraph"><p>The syntax for resource sets is described in detail for
<a href="#cmdhelp_configure_colocation"><span class="monospaced">colocation</span></a>.</p></div>
<div class="paragraph"><p>For more details on how to configure resource sets, see
<a href="#topics_Features_Resourcesets"><span class="monospaced">Syntax: Resource sets</span></a>.</p></div>
<div class="paragraph"><p>For more information on rule expressions, see
<a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>location &lt;id&gt; &lt;rsc&gt; [&lt;attributes&gt;] {&lt;node_pref&gt;|&lt;rules&gt;}

rsc :: /&lt;rsc-pattern&gt;/
        | { resource_sets }
        | &lt;rsc&gt;

attributes :: role=&lt;role&gt; | resource-discovery=always|never|exclusive

node_pref :: &lt;score&gt;: &lt;node&gt;

rules ::
  rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;: &lt;expression&gt;
  [rule [id_spec] [$role=&lt;role&gt;] &lt;score&gt;: &lt;expression&gt; ...]

id_spec :: $id=&lt;id&gt; | $id-ref=&lt;id&gt;
score :: &lt;number&gt; | &lt;attribute&gt; | [-]inf
expression :: &lt;simple_exp&gt; [&lt;bool_op&gt; &lt;simple_exp&gt; ...]
bool_op :: or | and
simple_exp :: &lt;attribute&gt; [type:]&lt;binary_op&gt; &lt;value&gt;
          | &lt;unary_op&gt; &lt;attribute&gt;
          | date &lt;date_expr&gt;
type :: string | version | number
binary_op :: lt | gt | lte | gte | eq | ne
unary_op :: defined | not_defined

date_expr :: lt &lt;end&gt;
         | gt &lt;start&gt;
         | in start=&lt;start&gt; end=&lt;end&gt;
         | in start=&lt;start&gt; &lt;duration&gt;
         | spec &lt;date_spec&gt;
duration|date_spec ::
         hours=&lt;value&gt;
         | monthdays=&lt;value&gt;
         | weekdays=&lt;value&gt;
         | yearsdays=&lt;value&gt;
         | months=&lt;value&gt;
         | weeks=&lt;value&gt;
         | years=&lt;value&gt;
         | weekyears=&lt;value&gt;
         | moon=&lt;value&gt;</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>location conn_1 internal_www 100: node1

location conn_1 internal_www \
  rule 50: #uname eq node1 \
  rule pingd: defined pingd

location conn_2 dummy_float \
  rule -inf: not_defined pingd or pingd number:lte 0

# never probe for rsc1 on node1
location no-probe rsc1 resource-discovery=never -inf: node1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_modgroup"><span class="monospaced">modgroup</span></h4>
<div class="paragraph"><p>Add or remove primitives in a group. The <span class="monospaced">add</span> subcommand appends
the new group member by default. Should it go elsewhere, there
are <span class="monospaced">after</span> and <span class="monospaced">before</span> clauses.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>modgroup &lt;id&gt; add &lt;id&gt; [after &lt;id&gt;|before &lt;id&gt;]
modgroup &lt;id&gt; remove &lt;id&gt;</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>modgroup share1 add storage2 before share1-fs</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_monitor"><span class="monospaced">monitor</span></h4>
<div class="paragraph"><p>Monitor is by far the most common operation. It is possible to
add it without editing the whole resource. Also, long primitive
definitions may be a bit uncluttered. In order to make this
command as concise as possible, less common operation attributes
are not available. If you need them, then use the <span class="monospaced">op</span> part of
the <span class="monospaced">primitive</span> command.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>monitor &lt;rsc&gt;[:&lt;role&gt;] &lt;interval&gt;[:&lt;timeout&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>monitor apcfence 60m:60s</pre>
</div></div>
<div class="paragraph"><p>Note that after executing the command, the monitor operation may
be shown as part of the primitive definition.</p></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_ms"><span class="monospaced">ms</span> (<span class="monospaced">master</span>)</h4>
<div class="paragraph"><p>The <span class="monospaced">ms</span> command creates a master/slave resource type. It may contain a
single primitive resource or one group of resources.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ms &lt;name&gt; &lt;rsc&gt;
  [description=&lt;description&gt;]
  [meta attr_list]
  [params attr_list]

attr_list :: [$id=&lt;id&gt;] &lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] | $id-ref=&lt;id&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ms disk1 drbd1 \
  meta notify=true globally-unique=false</pre>
</div></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Note on <span class="monospaced">id-ref</span> usage</div>
<div class="paragraph"><p>Instance or meta attributes (&#8216;params` and <span class="monospaced">meta</span>) may contain
a reference to another set of attributes. In that case, no other
attributes are allowed. Since attribute sets&#8217; ids, though they do
exist, are not shown in the <span class="monospaced">crm</span>, it is also possible to
reference an object instead of an attribute set. <span class="monospaced">crm</span> will
automatically replace such a reference with the right id:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)configure# primitive a2 www-2 meta $id-ref=a1
crm(live)configure# show a2
primitive a2 apache \
    meta $id-ref=a1-meta_attributes
    [...]</pre>
</div></div>
<div class="paragraph"><p>It is advisable to give meaningful names to attribute sets which
are going to be referenced.</p></div>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_node"><span class="monospaced">node</span></h4>
<div class="paragraph"><p>The node command describes a cluster node. Nodes in the CIB are
commonly created automatically by the CRM. Hence, you should not
need to deal with nodes unless you also want to define node
attributes. Note that it is also possible to manage node
attributes at the <span class="monospaced">node</span> level.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node [$id=&lt;id&gt;] &lt;uname&gt;[:&lt;type&gt;]
  [description=&lt;description&gt;]
  [attributes [$id=&lt;id&gt;] [&lt;score&gt;:] [rule...]
    &lt;param&gt;=&lt;value&gt; [&lt;param&gt;=&lt;value&gt;...]] | $id-ref=&lt;ref&gt;
  [utilization [$id=&lt;id&gt;] [&lt;score&gt;:] [rule...]
    &lt;param&gt;=&lt;value&gt; [&lt;param&gt;=&lt;value&gt;...]] | $id-ref=&lt;ref&gt;

type :: normal | member | ping | remote</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node node1
node big_node attributes memory=64</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_op_defaults"><span class="monospaced">op_defaults</span></h4>
<div class="paragraph"><p>Set defaults for the operations meta attributes.</p></div>
<div class="paragraph"><p>For more information on rule expressions, see
<a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>op_defaults [$id=&lt;set_id&gt;] [rule ...] &lt;option&gt;=&lt;value&gt; [&lt;option&gt;=&lt;value&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>op_defaults record-pending=true</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_order"><span class="monospaced">order</span></h4>
<div class="paragraph"><p>This constraint expresses the order of actions on two resources
or more resources. If there are more than two resources, then the
constraint is called a resource set.</p></div>
<div class="paragraph"><p>Ordered resource sets have an extra attribute to allow for sets
of resources whose actions may run in parallel. The shell syntax
for such sets is to put resources in parentheses.</p></div>
<div class="paragraph"><p>If the subsequent resource can start or promote after any one of the
resources in a set has done, enclose the set in brackets (<span class="monospaced">[</span> and <span class="monospaced">]</span>).</p></div>
<div class="paragraph"><p>Sets cannot be nested.</p></div>
<div class="paragraph"><p>Three strings are reserved to specify a kind of order constraint:
<span class="monospaced">Mandatory</span>, <span class="monospaced">Optional</span>, and <span class="monospaced">Serialize</span>. It is preferred to use
one of these settings instead of score. Previous versions mapped
scores <span class="monospaced">0</span> and <span class="monospaced">inf</span> to keywords <span class="monospaced">advisory</span> and <span class="monospaced">mandatory</span>.
That is still valid but deprecated.</p></div>
<div class="paragraph"><p>For more details on how to configure resource sets, see
<a href="#topics_Features_Resourcesets"><span class="monospaced">Syntax: Resource sets</span></a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>order &lt;id&gt; [{kind|&lt;score&gt;}:] first then [symmetrical=&lt;bool&gt;]

order &lt;id&gt; [{kind|&lt;score&gt;}:] resource_sets [symmetrical=&lt;bool&gt;]

kind :: Mandatory | Optional | Serialize

first :: &lt;rsc&gt;[:&lt;action&gt;]

then ::  &lt;rsc&gt;[:&lt;action&gt;]

resource_sets :: resource_set [resource_set ...]

resource_set :: ["["|"("] &lt;rsc&gt;[:&lt;action&gt;] [&lt;rsc&gt;[:&lt;action&gt;] ...] \
                [attributes] ["]"|")"]

attributes :: [require-all=(true|false)] [sequential=(true|false)]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>order o-1 Mandatory: apache:start ip_1
order o-2 Serialize: A ( B C )
order o-3 inf: [ A B ] C
order o-4 first-resource then-resource</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_primitive"><span class="monospaced">primitive</span></h4>
<div class="paragraph"><p>The primitive command describes a resource. It may be referenced
only once in group, clone, or master-slave objects. If it&#8217;s not
referenced, then it is placed as a single resource in the CIB.</p></div>
<div class="paragraph"><p>Operations may be specified anonymously, as a group or by reference:</p></div>
<div class="ulist"><ul>
<li>
<p>
"Anonymous", as a list of <span class="monospaced">op</span> specifications. Use this
  method if you don&#8217;t need to reference the set of operations
  elsewhere. This is the most common way to define operations.
</p>
</li>
<li>
<p>
If reusing operation sets is desired, use the <span class="monospaced">operations</span> keyword
  along with an id to give the operations set a name. Use the
  <span class="monospaced">operations</span> keyword and an id-ref value set to the id of another
  operations set, to apply the same set of operations to this
  primitive.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Operation attributes which are not recognized are saved as
instance attributes of that operation. A typical example is
<span class="monospaced">OCF_CHECK_LEVEL</span>.</p></div>
<div class="paragraph"><p>For multistate resources, roles are specified as <span class="monospaced">role=&lt;role&gt;</span>.</p></div>
<div class="paragraph"><p>A template may be defined for resources which are of the same
type and which share most of the configuration. See
<a href="#cmdhelp_configure_rsc_template"><span class="monospaced">rsc_template</span></a> for more information.</p></div>
<div class="paragraph"><p>Attributes containing time values, such as the <span class="monospaced">interval</span> attribute on
operations, are configured either as a plain number, which is
interpreted as a time in seconds, or using one of the following
suffixes:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">s</span>, <span class="monospaced">sec</span> - time in seconds (same as no suffix)
</p>
</li>
<li>
<p>
<span class="monospaced">ms</span>, <span class="monospaced">msec</span> - time in milliseconds
</p>
</li>
<li>
<p>
<span class="monospaced">us</span>, <span class="monospaced">usec</span> - time in microseconds
</p>
</li>
<li>
<p>
<span class="monospaced">m</span>, <span class="monospaced">min</span> - time in minutes
</p>
</li>
<li>
<p>
<span class="monospaced">h</span>, <span class="monospaced">hr</span> - time in hours
</p>
</li>
</ul></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive &lt;rsc&gt; {[&lt;class&gt;:[&lt;provider&gt;:]]&lt;type&gt;|@&lt;template&gt;}
  [description=&lt;description&gt;]
  [[params] attr_list]
  [meta attr_list]
  [utilization attr_list]
  [operations id_spec]
    [op op_type [&lt;attribute&gt;=&lt;value&gt;...] ...]

attr_list :: [$id=&lt;id&gt;] [&lt;score&gt;:] [rule...]
             &lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...]] | $id-ref=&lt;id&gt;
id_spec :: $id=&lt;id&gt; | $id-ref=&lt;id&gt;
op_type :: start | stop | monitor</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>primitive apcfence stonith:apcsmart \
  params ttydev=/dev/ttyS0 hostlist="node1 node2" \
  op start timeout=60s \
  op monitor interval=30m timeout=60s

primitive www8 apache \
  configfile=/etc/apache/www8.conf \
  operations $id-ref=apache_ops

primitive db0 mysql \
  params config=/etc/mysql/db0.conf \
  op monitor interval=60s \
  op monitor interval=300s OCF_CHECK_LEVEL=10

primitive r0 ocf:linbit:drbd \
  params drbd_resource=r0 \
  op monitor role=Master interval=60s \
  op monitor role=Slave interval=300s

primitive xen0 @vm_scheme1 xmfile=/etc/xen/vm/xen0

primitive mySpecialRsc Special \
  params 3: rule #uname eq node1 interface=eth1 \
  params 2: rule #uname eq node2 interface=eth2 port=8888 \
  params 1: interface=eth0 port=9999</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_property"><span class="monospaced">property</span></h4>
<div class="paragraph"><p>Set cluster configuration properties. To list the
available cluster configuration properties, use the
<a href="#cmdhelp_ra_info"><span class="monospaced">ra info</span></a> command with <span class="monospaced">pengine</span>, <span class="monospaced">crmd</span>,
<span class="monospaced">cib</span> and <span class="monospaced">stonithd</span> as arguments.
When setting the <span class="monospaced">maintenance-mode</span> property, it will
inform the user if there are nodes or resources that
have the <span class="monospaced">maintenance</span> property.</p></div>
<div class="paragraph"><p>For more information on rule expressions, see
<a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>property [&lt;set_id&gt;:] [rule ...] &lt;option&gt;=&lt;value&gt; [&lt;option&gt;=&lt;value&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>property stonith-enabled=true
property rule date spec years=2014 stonith-enabled=false</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_ptest"><span class="monospaced">ptest</span> (<span class="monospaced">simulate</span>)</h4>
<div class="paragraph"><p>Show PE (Policy Engine) motions using <span class="monospaced">ptest(8)</span> or
<span class="monospaced">crm_simulate(8)</span>.</p></div>
<div class="paragraph"><p>A CIB is constructed using the current user edited configuration
and the status from the running CIB. The resulting CIB is run
through <span class="monospaced">ptest</span> (or <span class="monospaced">crm_simulate</span>) to show changes which would
happen if the configuration is committed.</p></div>
<div class="paragraph"><p>The status section may be loaded from another source and modified
using the <a href="#cmdhelp_cibstatus"><span class="monospaced">cibstatus</span></a> level commands. In that case, the
<span class="monospaced">ptest</span> command will issue a message informing the user that the
Policy Engine graph is not calculated based on the current status
section and therefore won&#8217;t show what would happen to the
running but some imaginary cluster.</p></div>
<div class="paragraph"><p>If you have graphviz installed and X11 session, <span class="monospaced">dotty(1)</span> is run
to display the changes graphically.</p></div>
<div class="paragraph"><p>Add a string of <span class="monospaced">v</span> characters to increase verbosity. <span class="monospaced">ptest</span>
can also show allocation scores. <span class="monospaced">utilization</span> turns on
information about the remaining capacity of nodes. With the
<span class="monospaced">actions</span> option, <span class="monospaced">ptest</span> will print all resource actions.</p></div>
<div class="paragraph"><p>The <span class="monospaced">ptest</span> program has been replaced by <span class="monospaced">crm_simulate</span> in newer
Pacemaker versions. In some installations both could be
installed. Use <span class="monospaced">simulate</span> to enfore using <span class="monospaced">crm_simulate</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ptest [nograph] [v...] [scores] [actions] [utilization]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ptest scores
ptest vvvvv
simulate actions</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_refresh"><span class="monospaced">refresh</span></h4>
<div class="paragraph"><p>Refresh the internal structures from the CIB. All changes made
during this session are lost.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>refresh</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_rename"><span class="monospaced">rename</span></h4>
<div class="paragraph"><p>Rename an object. It is recommended to use this command to rename
a resource, because it will take care of updating all related
constraints and a parent resource. Changing ids with the edit
command won&#8217;t have the same effect.</p></div>
<div class="paragraph"><p>If you want to rename a resource, it must be in the stopped state.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rename &lt;old_id&gt; &lt;new_id&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_role"><span class="monospaced">role</span></h4>
<div class="paragraph"><p>An ACL role is a set of rules which describe access rights to
CIB. Rules consist of an access right <span class="monospaced">read</span>, <span class="monospaced">write</span>, or <span class="monospaced">deny</span>
and a specification denoting part of the configuration to which
the access right applies. The specification can be an XPath or a
combination of tag and id references. If an attribute is
appended, then the specification applies only to that attribute
of the matching element.</p></div>
<div class="paragraph"><p>There is a number of shortcuts for XPath specifications. The
<span class="monospaced">meta</span>, <span class="monospaced">params</span>, and <span class="monospaced">utilization</span> shortcuts reference resource
meta attributes, parameters, and utilization respectively. The
<span class="monospaced">location</span> may be used to specify location constraints most of
the time to allow resource <span class="monospaced">move</span> and <span class="monospaced">unmove</span> commands. The
<span class="monospaced">property</span> references cluster properties. The <span class="monospaced">node</span> allows
reading node attributes. <span class="monospaced">nodeattr</span> and <span class="monospaced">nodeutil</span> reference node
attributes and node capacity (utilization). The <span class="monospaced">status</span> shortcut
references the whole status section of the CIB. Read access to
status is necessary for various monitoring tools such as
<span class="monospaced">crm_mon(8)</span> (aka <span class="monospaced">crm status</span>).</p></div>
<div class="paragraph"><p>For more information on rule expressions, see
<a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>role &lt;role-id&gt; rule [rule ...]

rule :: acl-right cib-spec [attribute:&lt;attribute&gt;]

acl-right :: read | write | deny

cib-spec :: xpath-spec | tag-ref-spec
xpath-spec :: xpath:&lt;xpath&gt; | shortcut
tag-ref-spec :: tag:&lt;tag&gt; | ref:&lt;id&gt; | tag:&lt;tag&gt; ref:&lt;id&gt;

shortcut :: meta:&lt;rsc&gt;[:&lt;attr&gt;]
        params:&lt;rsc&gt;[:&lt;attr&gt;]
        utilization:&lt;rsc&gt;
        location:&lt;rsc&gt;
        property[:&lt;attr&gt;]
        node[:&lt;node&gt;]
        nodeattr[:&lt;attr&gt;]
        nodeutil[:&lt;node&gt;]
        status</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>role app1_admin \
    write meta:app1:target-role \
    write meta:app1:is-managed \
    write location:app1 \
    read ref:app1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_rsc_defaults"><span class="monospaced">rsc_defaults</span></h4>
<div class="paragraph"><p>Set defaults for the resource meta attributes.</p></div>
<div class="paragraph"><p>For more information on rule expressions, see
<a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsc_defaults [&lt;set_id&gt;:] [rule ...] &lt;option&gt;=&lt;value&gt; [&lt;option&gt;=&lt;value&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsc_defaults failure-timeout=3m</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_rsc_template"><span class="monospaced">rsc_template</span></h4>
<div class="paragraph"><p>The <span class="monospaced">rsc_template</span> command creates a resource template. It may be
referenced in primitives. It is used to reduce large
configurations with many similar resources.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsc_template &lt;name&gt; [&lt;class&gt;:[&lt;provider&gt;:]]&lt;type&gt;
  [description=&lt;description&gt;]
  [params attr_list]
  [meta attr_list]
  [utilization attr_list]
  [operations id_spec]
    [op op_type [&lt;attribute&gt;=&lt;value&gt;...] ...]

attr_list :: [$id=&lt;id&gt;] &lt;attr&gt;=&lt;val&gt; [&lt;attr&gt;=&lt;val&gt;...] | $id-ref=&lt;id&gt;
id_spec :: $id=&lt;id&gt; | $id-ref=&lt;id&gt;
op_type :: start | stop | monitor</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsc_template public_vm Xen \
  op start timeout=300s \
  op stop timeout=300s \
  op monitor interval=30s timeout=60s \
  op migrate_from timeout=600s \
  op migrate_to timeout=600s
primitive xen0 @public_vm \
  params xmfile=/etc/xen/xen0
primitive xen1 @public_vm \
  params xmfile=/etc/xen/xen1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_rsc_ticket"><span class="monospaced">rsc_ticket</span></h4>
<div class="paragraph"><p>This constraint expresses dependency of resources on cluster-wide
attributes, also known as tickets. Tickets are mainly used in
geo-clusters, which consist of multiple sites. A ticket may be
granted to a site, thus allowing resources to run there.</p></div>
<div class="paragraph"><p>The <span class="monospaced">loss-policy</span> attribute specifies what happens to the
resource (or resources) if the ticket is revoked. The default is
either <span class="monospaced">stop</span> or <span class="monospaced">demote</span> depending on whether a resource is
multi-state.</p></div>
<div class="paragraph"><p>See also the <a href="#cmdhelp_site_ticket"><span class="monospaced">site</span></a> set of commands.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsc_ticket &lt;id&gt; &lt;ticket_id&gt;: &lt;rsc&gt;[:&lt;role&gt;] [&lt;rsc&gt;[:&lt;role&gt;] ...]
  [loss-policy=&lt;loss_policy_action&gt;]

loss_policy_action :: stop | demote | fence | freeze</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsc_ticket ticket-A_public-ip ticket-A: public-ip
rsc_ticket ticket-A_bigdb ticket-A: bigdb loss-policy=fence
rsc_ticket ticket-B_storage ticket-B: drbd-a:Master drbd-b:Master</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_rsctest"><span class="monospaced">rsctest</span></h4>
<div class="paragraph"><p>Test resources with current resource configuration. If no nodes
are specified, tests are run on all known nodes.</p></div>
<div class="paragraph"><p>The order of resources is significant: it is assumed that later
resources depend on earlier ones.</p></div>
<div class="paragraph"><p>If a resource is multi-state, it is assumed that the role on
which later resources depend is master.</p></div>
<div class="paragraph"><p>Tests are run sequentially to prevent running the same resource
on two or more nodes. Tests are carried out only if none of the
specified nodes currently run any of the specified resources.
However, it won&#8217;t verify whether resources run on the other
nodes.</p></div>
<div class="paragraph"><p>Superuser privileges are obviously required: either run this as
root or setup the <span class="monospaced">sudoers</span> file appropriately.</p></div>
<div class="paragraph"><p>Note that resource testing may take some time.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsctest &lt;rsc_id&gt; [&lt;rsc_id&gt; ...] [&lt;node_id&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rsctest my_ip websvc
rsctest websvc nodeB</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_save"><span class="monospaced">save</span></h4>
<div class="paragraph"><p>Save the current configuration to a file. Optionally, as XML. Use
<span class="monospaced">-</span> instead of file name to write the output to <span class="monospaced">stdout</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">save</span> command accepts the same selection arguments as the <span class="monospaced">show</span>
command. See the <a href="#cmdhelp_configure_show">help section</a> for <span class="monospaced">show</span>
for more details.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>save [xml] [&lt;id&gt; | type:&lt;type | tag:&lt;tag&gt; |
            related:&lt;obj&gt; | changed ...] &lt;file&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>save myfirstcib.txt
save web-server server-config.txt</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_schema"><span class="monospaced">schema</span></h4>
<div class="paragraph"><p>CIB&#8217;s content is validated by a RNG schema. Pacemaker supports
several, depending on version. At least the following schemas are
accepted by <span class="monospaced">crmsh</span>:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">pacemaker-1.0</span>
</p>
</li>
<li>
<p>
<span class="monospaced">pacemaker-1.1</span>
</p>
</li>
<li>
<p>
<span class="monospaced">pacemaker-1.2</span>
</p>
</li>
<li>
<p>
<span class="monospaced">pacemaker-1.3</span>
</p>
</li>
<li>
<p>
<span class="monospaced">pacemaker-2.0</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Use this command to display or switch to another RNG schema.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>schema [&lt;schema&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>schema pacemaker-1.1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_set"><span class="monospaced">set</span></h4>
<div class="paragraph"><p>Set the value of a configured attribute. The attribute must
have a value configured previously, and can be an agent
parameter, meta attribute or utilization value.</p></div>
<div class="paragraph"><p>The first argument to the command is a path to an attribute.
This is a dot-separated sequence beginning with the name of
the resource, and ending with the name of the attribute to
set.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>set &lt;path&gt; &lt;value&gt;</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>set vip1.ip 192.168.20.5
set vm-a.force_stop 1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>The <span class="monospaced">show</span> command displays CIB objects. Without any argument, it
displays all objects in the CIB, but the set of objects displayed by
<span class="monospaced">show</span> can be limited to only objects with the given IDs or by using
one or more of the special prefixes described below.</p></div>
<div class="paragraph"><p>The XML representation for the objects can be displayed by passing
<span class="monospaced">xml</span> as the first argument.</p></div>
<div class="paragraph"><p>To show one or more specific objects, pass the object IDs as
arguments.</p></div>
<div class="paragraph"><p>To show all objects of a certain type, use the <span class="monospaced">type:</span> prefix.</p></div>
<div class="paragraph"><p>To show all objects in a tag, use the <span class="monospaced">tag:</span> prefix.</p></div>
<div class="paragraph"><p>To show all constraints related to a primitive, use the <span class="monospaced">related:</span> prefix.</p></div>
<div class="paragraph"><p>To show all modified objects, pass the argument <span class="monospaced">changed</span>.</p></div>
<div class="paragraph"><p>The prefixes can be used together on a single command line. For
example, to show both the tag itself and the objects tagged by it the
following combination can be used: <span class="monospaced">show tag:my-tag my-tag</span>.</p></div>
<div class="paragraph"><p>To refine a selection of objects using multiple modifiers, the keywords
<span class="monospaced">and</span> and <span class="monospaced">or</span> can be used. For example, to select all primitives tagged
<span class="monospaced">foo</span>, the following combination can be used:
<span class="monospaced">show type:primitive and tag:foo</span>.</p></div>
<div class="paragraph"><p>To hide values when displaying the configuration, use the
<span class="monospaced">obscure:&lt;glob&gt;</span> argument. This can be useful when sending the
configuration over a public channel, to avoid exposing potentially
sensitive information. The <span class="monospaced">&lt;glob&gt;</span> argument is a bash-style pattern
matching attribute keys.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show [xml] [&lt;id&gt;
           | changed
           | type:&lt;type&gt;
           | tag:&lt;id&gt;
           | related:&lt;obj&gt;
           | obscure:&lt;glob&gt;
           ...]

type :: node | primitive | group | clone | ms | rsc_template
      | location | colocation | order
      | rsc_ticket
      | property | rsc_defaults | op_defaults
      | fencing_topology
      | role | user | acl_target
      | tag</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show webapp
show type:primitive
show xml tag:db tag:fs
show related:webapp
show type:primitive obscure:passwd</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_tag"><span class="monospaced">tag</span></h4>
<div class="paragraph"><p>Define a resource tag. A tag is an id referring to one or more
resources, without implying any constraints between the tagged
resources. This can be useful for grouping conceptually related
resources.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>tag &lt;tag-name&gt;: &lt;rsc&gt; [&lt;rsc&gt; ...]
tag &lt;tag-name&gt; &lt;rsc&gt; [&lt;rsc&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>tag web: p-webserver p-vip
tag ips server-vip admin-vip</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_template"><span class="monospaced">template</span></h4>
<div class="paragraph"><p>The specified template is loaded into the editor. It&#8217;s up to the
user to make a good CRM configuration out of it. See also the
<a href="#cmdhelp_template">template section</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>template [xml] url</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>template two-apaches.txt</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_upgrade"><span class="monospaced">upgrade</span></h4>
<div class="paragraph"><p>Attempts to upgrade the CIB to validate with the current
version. Commonly, this is required if the error
<span class="monospaced">CIB not supported</span> occurs. It typically means that the
active CIB version is coming from an older release.</p></div>
<div class="paragraph"><p>As a safety precaution, the force argument is required if the
<span class="monospaced">validation-with</span> attribute is set to anything other than
<span class="monospaced">0.6</span>. Thus in most cases, it is required.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>upgrade [force]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>upgrade force</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_user"><span class="monospaced">user</span></h4>
<div class="paragraph"><p>Users which normally cannot view or manage cluster configuration
can be allowed access to parts of the CIB. The access is defined
by a set of <span class="monospaced">read</span>, <span class="monospaced">write</span>, and <span class="monospaced">deny</span> rules as in role
definitions or by referencing roles. The latter is considered
best practice.</p></div>
<div class="paragraph"><p>For more information on rule expressions, see
<a href="#topics_Syntax_RuleExpressions">Syntax: Rule expressions</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>user &lt;uid&gt; {roles|rules}

roles :: role:&lt;role-ref&gt; [role:&lt;role-ref&gt; ...]
rules :: rule [rule ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>user joe \
    role:app1_admin \
    role:read_all</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_validate_all"><span class="monospaced">validate-all</span></h4>
<div class="paragraph"><p>Call the <span class="monospaced">validate-all</span> action for the resource, if possible.</p></div>
<div class="paragraph"><p>Limitations:</p></div>
<div class="ulist"><ul>
<li>
<p>
The resource agent must implement the <span class="monospaced">validate-all</span> action.
</p>
</li>
<li>
<p>
The current user must be root.
</p>
</li>
<li>
<p>
The primitive resource must not use nvpair references.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>validate-all &lt;rsc&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_verify"><span class="monospaced">verify</span></h4>
<div class="paragraph"><p>Verify the contents of the CIB which would be committed.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>verify</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_configure_xml"><span class="monospaced">xml</span></h4>
<div class="paragraph"><p>Even though we promissed no xml, it may happen, but hopefully
very very seldom, that an element from the CIB cannot be rendered
in the configuration language. In that case, the element will be
shown as raw xml, prefixed by this command. That element can then
be edited like any other. If the shell finds out that after the
change it can digest it, then it is going to be converted into
the normal configuration language. Otherwise, there is no need to
use <span class="monospaced">xml</span> for configuration.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>xml &lt;xml&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_template"><span class="monospaced">template</span> - Import configuration from templates</h3>
<div class="paragraph"><p>User may be assisted in the cluster configuration by templates
prepared in advance. Templates consist of a typical ready
configuration which may be edited to suit particular user needs.</p></div>
<div class="paragraph"><p>This command enters a template level where additional commands
for configuration/template management are available.</p></div>
<div class="sect3">
<h4 id="cmdhelp_template_apply"><span class="monospaced">apply</span></h4>
<div class="paragraph"><p>Copy the current or given configuration to the current CIB. By
default, the CIB is replaced, unless the method is set to
"update".</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>apply [&lt;method&gt;] [&lt;config&gt;]

method :: replace | update</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_template_delete"><span class="monospaced">delete</span></h4>
<div class="paragraph"><p>Remove a configuration. The loaded (active) configuration may be
removed by force.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>delete &lt;config&gt; [force]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_template_edit"><span class="monospaced">edit</span></h4>
<div class="paragraph"><p>Edit current or given configuration using your favourite editor.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>edit [&lt;config&gt;]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_template_list"><span class="monospaced">list</span></h4>
<div class="paragraph"><p>When called with no argument, lists existing templates and
configurations.</p></div>
<div class="paragraph"><p>Given the argument <span class="monospaced">templates</span>, lists the available templates.</p></div>
<div class="paragraph"><p>Given the argument <span class="monospaced">configs</span>, lists the available configurations.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>list [templates|configs]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_template_load"><span class="monospaced">load</span></h4>
<div class="paragraph"><p>Load an existing configuration. Further <span class="monospaced">edit</span>, <span class="monospaced">show</span>, and
<span class="monospaced">apply</span> commands will refer to this configuration.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>load &lt;config&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_template_new"><span class="monospaced">new</span></h4>
<div class="paragraph"><p>Create a new configuration from one or more templates. Note that
configurations and templates are kept in different places, so it
is possible to have a configuration name equal a template name.</p></div>
<div class="paragraph"><p>If you already know which parameters are required, you can set
them directly on the command line.</p></div>
<div class="paragraph"><p>The parameter name <span class="monospaced">id</span> is set by default to the name of the
configuration.</p></div>
<div class="paragraph"><p>If no parameters are being set and you don&#8217;t want a particular name
for your configuration, you can call this command with a template name
as the only parameter. A unique configuration name based on the
template name will be generated.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>new [&lt;config&gt;] &lt;template&gt; [&lt;template&gt; ...] [params name=value ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>new vip virtual-ip
new bigfs ocfs2 params device=/dev/sdx8 directory=/bigfs
new apache</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_template_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Process the current or given configuration and display the result.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show [&lt;config&gt;]</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_cibstatus"><span class="monospaced">cibstatus</span> - CIB status management and editing</h3>
<div class="paragraph"><p>The <span class="monospaced">status</span> section of the CIB keeps the current status of nodes
and resources. It is modified <em>only</em> on events, i.e. when some
resource operation is run or node status changes. For obvious
reasons, the CRM has no user interface with which it is possible
to affect the status section. From the user&#8217;s point of view, the
status section is essentially a read-only part of the CIB. The
current status is never even written to disk, though it is
available in the PE (Policy Engine) input files which represent
the history of cluster motions. The current status may be read
using the <span class="monospaced">cibadmin -Q</span> command.</p></div>
<div class="paragraph"><p>It may sometimes be of interest to see how status changes would
affect the Policy Engine. The set of &#8216;cibstatus` level commands
allow the user to load status sections from various sources and
then insert or modify resource operations or change nodes&#8217; state.</p></div>
<div class="paragraph"><p>The effect of those changes may then be observed by running the
<a href="#cmdhelp_configure_ptest"><span class="monospaced">ptest</span></a> command at the <span class="monospaced">configure</span> level
or <span class="monospaced">simulate</span> and <span class="monospaced">run</span> commands at this level. The <span class="monospaced">ptest</span>
runs with the user edited CIB whereas the latter two commands
run with the CIB which was loaded along with the status section.</p></div>
<div class="paragraph"><p>The <span class="monospaced">simulate</span> and <span class="monospaced">run</span> commands as well as all status
modification commands are implemented using <span class="monospaced">crm_simulate(8)</span>.</p></div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_load"><span class="monospaced">load</span></h4>
<div class="paragraph"><p>Load a status section from a file, a shadow CIB, or the running
cluster. By default, the current (<span class="monospaced">live</span>) status section is
modified. Note that if the <span class="monospaced">live</span> status section is modified it
is not going to be updated if the cluster status changes, because
that would overwrite the user changes. To make <span class="monospaced">crm</span> drop changes
and resume use of the running cluster status, run <span class="monospaced">load live</span>.</p></div>
<div class="paragraph"><p>All CIB shadow configurations contain the status section which is
a snapshot of the status section taken at the time the shadow was
created. Obviously, this status section doesn&#8217;t have much to do
with the running cluster status, unless the shadow CIB has just
been created. Therefore, the <span class="monospaced">ptest</span> command by default uses the
running cluster status section.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>load {&lt;file&gt;|shadow:&lt;cib&gt;|live}</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>load bug-12299.xml
load shadow:test1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_node"><span class="monospaced">node</span></h4>
<div class="paragraph"><p>Change the node status. It is possible to throw a node out of
the cluster, make it a member, or set its state to unclean.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">online</span>
</dt>
<dd>
<p>
Set the <span class="monospaced">node_state</span> <span class="monospaced">crmd</span> attribute to <span class="monospaced">online</span>
and the <span class="monospaced">expected</span> and <span class="monospaced">join</span> attributes to <span class="monospaced">member</span>. The effect
is that the node becomes a cluster member.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">offline</span>
</dt>
<dd>
<p>
Set the <span class="monospaced">node_state</span> <span class="monospaced">crmd</span> attribute to <span class="monospaced">offline</span>
and the <span class="monospaced">expected</span> attribute to empty. This makes the node
cleanly removed from the cluster.
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">unclean</span>
</dt>
<dd>
<p>
Set the <span class="monospaced">node_state</span> <span class="monospaced">crmd</span> attribute to <span class="monospaced">offline</span>
and the <span class="monospaced">expected</span> attribute to <span class="monospaced">member</span>. In this case the node
has unexpectedly disappeared.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node &lt;node&gt; {online|offline|unclean}</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node xen-b unclean</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_op"><span class="monospaced">op</span></h4>
<div class="paragraph"><p>Edit the outcome of a resource operation. This way you can
tell CRM that it ran an operation and that the resource agent
returned certain exit code. It is also possible to change the
operation&#8217;s status. In case the operation status is set to
something other than <span class="monospaced">done</span>, the exit code is effectively
ignored.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>op &lt;operation&gt; &lt;resource&gt; &lt;exit_code&gt; [&lt;op_status&gt;] [&lt;node&gt;]

operation :: probe | monitor[:&lt;n&gt;] | start | stop |
   promote | demote | notify | migrate_to | migrate_from
exit_code :: &lt;rc&gt; | success | generic | args |
   unimplemented | perm | installed | configured | not_running |
   master | failed_master
op_status :: pending | done | cancelled | timeout | notsupported | error

n :: the monitor interval in seconds; if omitted, the first
   recurring operation is referenced
rc :: numeric exit code in range 0..9</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>op start d1 xen-b generic
op start d1 xen-b 1
op monitor d1 xen-b not_running
op stop d1 xen-b 0 timeout</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_origin"><span class="monospaced">origin</span></h4>
<div class="paragraph"><p>Show the origin of the status section currently in use. This
essentially shows the latest <span class="monospaced">load</span> argument.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>origin</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_quorum"><span class="monospaced">quorum</span></h4>
<div class="paragraph"><p>Set the quorum value.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>quorum &lt;bool&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>quorum false</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_run"><span class="monospaced">run</span></h4>
<div class="paragraph"><p>Run the policy engine with the edited status section.</p></div>
<div class="paragraph"><p>Add a string of <span class="monospaced">v</span> characters to increase verbosity. Specify
<span class="monospaced">scores</span> to see allocation scores also. <span class="monospaced">utilization</span> turns on
information about the remaining capacity of nodes.</p></div>
<div class="paragraph"><p>If you have graphviz installed and X11 session, <span class="monospaced">dotty(1)</span> is run
to display the changes graphically.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>run [nograph] [v...] [scores] [utilization]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>run</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_save"><span class="monospaced">save</span></h4>
<div class="paragraph"><p>The current internal status section with whatever modifications
were performed can be saved to a file or shadow CIB.</p></div>
<div class="paragraph"><p>If the file exists and contains a complete CIB, only the status
section is going to be replaced and the rest of the CIB will
remain intact. Otherwise, the current user edited configuration
is saved along with the status section.</p></div>
<div class="paragraph"><p>Note that all modifications are saved in the source file as soon
as they are run.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>save [&lt;file&gt;|shadow:&lt;cib&gt;]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>save bug-12299.xml</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Show the current status section in the XML format. Brace yourself
for some unreadable output. Add <span class="monospaced">changed</span> option to get a human
readable output of all changes.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show [changed]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_simulate"><span class="monospaced">simulate</span></h4>
<div class="paragraph"><p>Run the policy engine with the edited status section and simulate
the transition.</p></div>
<div class="paragraph"><p>Add a string of <span class="monospaced">v</span> characters to increase verbosity. Specify
<span class="monospaced">scores</span> to see allocation scores also. <span class="monospaced">utilization</span> turns on
information about the remaining capacity of nodes.</p></div>
<div class="paragraph"><p>If you have graphviz installed and X11 session, <span class="monospaced">dotty(1)</span> is run
to display the changes graphically.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>simulate [nograph] [v...] [scores] [utilization]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>simulate</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_cibstatus_ticket"><span class="monospaced">ticket</span></h4>
<div class="paragraph"><p>Modify the ticket status. Tickets can be granted and revoked.
Granted tickets could be activated or put in standby.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ticket &lt;ticket&gt; {grant|revoke|activate|standby}</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ticket ticketA grant</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_assist"><span class="monospaced">assist</span> - Configuration assistant</h3>
<div class="paragraph"><p>The <span class="monospaced">assist</span> sublevel is a collection of helper
commands that create or modify resources and
constraints, to simplify the creation of certain
configurations.</p></div>
<div class="paragraph"><p>For more information on individual commands, see
the help text for those commands.</p></div>
<div class="sect3">
<h4 id="cmdhelp_assist_template"><span class="monospaced">template</span></h4>
<div class="paragraph"><p>This command takes a list of primitives as argument, and creates a new
<span class="monospaced">rsc_template</span> for these primitives. It can only do this if the
primitives do not already share a template and are of the same type.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>template primitive-1 primitive-2 primitive-3</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_assist_weak-bond"><span class="monospaced">weak-bond</span></h4>
<div class="paragraph"><p>A colocation between a group of resources says that the resources
should be located together, but it also means that those resources are
dependent on each other. If one of the resources fails, the others
will be restarted.</p></div>
<div class="paragraph"><p>If this is not desired, it is possible to circumvent: By placing the
resources in a non-sequential set and colocating the set with a dummy
resource which is not monitored, the resources will be placed together
but will have no further dependency on each other.</p></div>
<div class="paragraph"><p>This command creates both the constraint and the dummy resource needed
for such a colocation.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>weak-bond resource-1 resource-2</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_maintenance"><span class="monospaced">maintenance</span> - Maintenance mode commands</h3>
<div class="paragraph"><p>Maintenance mode commands are commands that manipulate resources
directly without going through the cluster infrastructure. Therefore,
it is essential to ensure that the cluster does not attempt to monitor
or manipulate the resources while these commands are being executed.</p></div>
<div class="paragraph"><p>To ensure this, these commands require that maintenance mode is set
either for the particular resource, or for the whole cluster.</p></div>
<div class="sect3">
<h4 id="cmdhelp_maintenance_action"><span class="monospaced">action</span></h4>
<div class="paragraph"><p>Invokes the given action for the resource. This is
done directly via the resource agent, so the command must
be issued while the cluster or the resource is in
maintenance mode.</p></div>
<div class="paragraph"><p>Unless the action is <span class="monospaced">start</span> or <span class="monospaced">monitor</span>, the action must be invoked
on the same node as where the resource is running. If the resource is
running on multiple nodes, the command will fail.</p></div>
<div class="paragraph"><p>To use SSH for executing resource actions on multiple nodes, append
<span class="monospaced">ssh</span> after the action name. This requires SSH access to be configured
between the nodes and the parallax python package to be installed.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>action &lt;rsc&gt; &lt;action&gt;
action &lt;rsc&gt; &lt;action&gt; ssh</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>action webserver reload
action webserver monitor ssh</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_maintenance_off"><span class="monospaced">off</span></h4>
<div class="paragraph"><p>Disables maintenances mode, either for the whole cluster
or for the given resource.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>off
off &lt;rsc&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>off rsc1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_maintenance_on"><span class="monospaced">on</span></h4>
<div class="paragraph"><p>Enables maintenances mode, either for the whole cluster
or for the given resource.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>on
on &lt;rsc&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>on rsc1</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_history"><span class="monospaced">history</span> - Cluster history</h3>
<div class="paragraph"><p>Examining Pacemaker&#8217;s history is a particularly involved task. The
number of subsystems to be considered, the complexity of the
configuration, and the set of various information sources, most of
which are not exactly human readable, keep analyzing resource or node
problems accessible to only the most knowledgeable. Or, depending on
the point of view, to the most persistent. The following set of
commands has been devised in hope to make cluster history more
accessible.</p></div>
<div class="paragraph"><p>Of course, looking at <em>all</em> history could be time consuming regardless
of how good the tools at hand are. Therefore, one should first say
which period he or she wants to analyze. If not otherwise specified,
the last hour is considered. Logs and other relevant information is
collected using <span class="monospaced">crm report</span>. Since this process takes some time and
we always need fresh logs, information is refreshed in a much faster
way using the python parallax module. If <span class="monospaced">python-parallax</span> is not
found on the system, examining a live cluster is still possible&#8201;&#8212;&#8201;though not as comfortable.</p></div>
<div class="paragraph"><p>Apart from examining a live cluster, events may be retrieved from a
report generated by <span class="monospaced">crm report</span> (see also the <span class="monospaced">-H</span> option). In that
case we assume that the period stretching the whole report needs to be
investigated. Of course, it is still possible to further reduce the
time range.</p></div>
<div class="paragraph"><p>If you have discovered an issue that you want to show someone else,
you can use the <span class="monospaced">session pack</span> command to save the current session as
a tarball, similar to those generated by <span class="monospaced">crm report</span>.</p></div>
<div class="paragraph"><p>In order to minimize the size of the tarball, and to make it easier
for others to find the interesting events, it is recommended to limit
the time frame which the saved session covers. This can be done using
the <span class="monospaced">timeframe</span> command (example below).</p></div>
<div class="paragraph"><p>It is also possible to name the saved session using the <span class="monospaced">session save</span>
command.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>crm(live)history# limit "Jul 18 12:00" "Jul 18 12:30"
crm(live)history# session save strange_restart
crm(live)history# session pack
Report saved in .../strange_restart.tar.bz2
crm(live)history#</pre>
</div></div>
<div class="sect3">
<h4 id="cmdhelp_history_detail"><span class="monospaced">detail</span></h4>
<div class="paragraph"><p>How much detail to show from the logs. Valid detail levels are either
<span class="monospaced">0</span> or <span class="monospaced">1</span>, where <span class="monospaced">1</span> is the highest detail level. The default detail
level is <span class="monospaced">0</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>detail &lt;detail_level&gt;

detail_level :: small integer (defaults to 0)</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>detail 1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_diff"><span class="monospaced">diff</span></h4>
<div class="paragraph"><p>A transition represents a change in cluster configuration or
state. Use <span class="monospaced">diff</span> to see what has changed between two
transitions.</p></div>
<div class="paragraph"><p>If you want to specify the current cluster configuration and
status, use the string <span class="monospaced">live</span>.</p></div>
<div class="paragraph"><p>Normally, the first transition specified should be the one which
is older, but we are not going to enforce that.</p></div>
<div class="paragraph"><p>Note that a single configuration update may result in more than
one transition.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff &lt;pe&gt; &lt;pe&gt; [status] [html]

pe :: &lt;number&gt;|&lt;index&gt;|&lt;file&gt;|live</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff 2066 2067
diff pe-input-2080.bz2 live status</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_events"><span class="monospaced">events</span></h4>
<div class="paragraph"><p>By analysing the log output and looking for particular
patterns, the <span class="monospaced">events</span> command helps sifting through
the logs to find when particular events like resources
changing state or node failure may have occurred.</p></div>
<div class="paragraph"><p>This can be used to generate a combined list of events
from all nodes.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>events</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>events</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_exclude"><span class="monospaced">exclude</span></h4>
<div class="paragraph"><p>If a log is infested with irrelevant messages, those messages may
be excluded by specifying a regular expression. The regular
expressions used are Python extended. This command is additive.
To drop all regular expressions, use <span class="monospaced">exclude clear</span>. Run
<span class="monospaced">exclude</span> only to see the current list of regular expressions.
Excludes are saved along with the history sessions.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>exclude [&lt;regex&gt;|clear]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>exclude kernel.*ocfs2</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_graph"><span class="monospaced">graph</span></h4>
<div class="paragraph"><p>Create a graphviz graphical layout from the PE file (the
transition). Every transition contains the cluster configuration
which was active at the time. See also <a href="#cmdhelp_configure_graph">generate a directed graph from configuration</a>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>graph &lt;pe&gt; [&lt;gtype&gt; [&lt;file&gt; [&lt;img_format&gt;]]]

gtype :: dot
img_format :: `dot` output format (see the +-T+ option)</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>graph -1
graph 322 dot clu1.conf.dot
graph 322 dot clu1.conf.svg svg</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_info"><span class="monospaced">info</span></h4>
<div class="paragraph"><p>The <span class="monospaced">info</span> command provides a summary of the information source, which
can be either a live cluster snapshot or a previously generated
report.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>info</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>info</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_latest"><span class="monospaced">latest</span></h4>
<div class="paragraph"><p>The <span class="monospaced">latest</span> command shows a bit of recent history, more
precisely whatever happened since the last cluster change (the
latest transition). If the transition is running, the shell will
first wait until it finishes.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>latest</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>latest</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_limit"><span class="monospaced">limit</span> (<span class="monospaced">timeframe</span>)</h4>
<div class="paragraph"><p>This command can be used to modify the time span to examine. All
history commands look at events within a certain time span.</p></div>
<div class="paragraph"><p>For the <span class="monospaced">live</span> source, the default time span is the <em>last hour</em>.</p></div>
<div class="paragraph"><p>There is no time span limit for the <span class="monospaced">hb_report</span> source.</p></div>
<div class="paragraph"><p>The time period is parsed by the <span class="monospaced">dateutil</span> python module. It
covers a wide range of date formats. For instance:</p></div>
<div class="ulist"><ul>
<li>
<p>
3:00          (today at 3am)
</p>
</li>
<li>
<p>
15:00         (today at 3pm)
</p>
</li>
<li>
<p>
2010/9/1 2pm  (September 1st 2010 at 2pm)
</p>
</li>
</ul></div>
<div class="paragraph"><p>For more examples of valid time/date statements, please refer to the
<span class="monospaced">python-dateutil</span> documentation:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://dateutil.readthedocs.org/">dateutil.readthedocs.org</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>If the dateutil module is not available, then the time is parsed using
strptime and only the kind as printed by <span class="monospaced">date(1)</span> is allowed:</p></div>
<div class="ulist"><ul>
<li>
<p>
Tue Sep 15 20:46:27 CEST 2010
</p>
</li>
</ul></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>limit [&lt;from_time&gt;] [&lt;to_time&gt;]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>limit 10:15
limit 15h22m 16h
limit "Sun 5 20:46" "Sun 5 22:00"</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_log"><span class="monospaced">log</span></h4>
<div class="paragraph"><p>Show messages logged on one or more nodes. Leaving out a node
name produces combined logs of all nodes. Messages are sorted by
time and, if the terminal emulations supports it, displayed in
different colours depending on the node to allow for easier
reading.</p></div>
<div class="paragraph"><p>The sorting key is the timestamp as written by syslog which
normally has the maximum resolution of one second. Obviously,
messages generated by events which share the same timestamp may
not be sorted in the same way as they happened. Such close events
may actually happen fairly often.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>log [&lt;node&gt; [&lt;node&gt; ...] ]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>log node-a</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_node"><span class="monospaced">node</span></h4>
<div class="paragraph"><p>Show important events that happened on a node. Important events
are node lost and join, standby and online, and fence. Use either
node names or extended regular expressions.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node &lt;node&gt; [&lt;node&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>node node1</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_peinputs"><span class="monospaced">peinputs</span></h4>
<div class="paragraph"><p>Every event in the cluster results in generating one or more
Policy Engine (PE) files. These files describe future motions of
resources. The files are listed as full paths in the current
report directory. Add <span class="monospaced">v</span> to also see the creation time stamps.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>peinputs [{&lt;range&gt;|&lt;number&gt;} ...] [v]

range :: &lt;n1&gt;:&lt;n2&gt;</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>peinputs
peinputs 440:444 446
peinputs v</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_refresh"><span class="monospaced">refresh</span></h4>
<div class="paragraph"><p>This command makes sense only for the <span class="monospaced">live</span> source and makes
<span class="monospaced">crm</span> collect the latest logs and other relevant information from
the logs. If you want to make a completely new report, specify
<span class="monospaced">force</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>refresh [force]</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_resource"><span class="monospaced">resource</span></h4>
<div class="paragraph"><p>Show actions and any failures that happened on all specified
resources on all nodes. Normally, one gives resource names as
arguments, but it is also possible to use extended regular
expressions. Note that neither groups nor clones or master/slave
names are ever logged. The resource command is going to expand
all of these appropriately, so that clone instances or resources
which are part of a group are shown.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>resource &lt;rsc&gt; [&lt;rsc&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>resource bigdb public_ip
resource my_.*_db2
resource ping_clone</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_session"><span class="monospaced">session</span></h4>
<div class="paragraph"><p>Sometimes you may want to get back to examining a particular
history period or bug report. In order to make that easier, the
current settings can be saved and later retrieved.</p></div>
<div class="paragraph"><p>If the current history being examined is coming from a live
cluster the logs, PE inputs, and other files are saved too,
because they may disappear from nodes. For the existing reports
coming from <span class="monospaced">hb_report</span>, only the directory location is saved
(not to waste space).</p></div>
<div class="paragraph"><p>A history session may also be packed into a tarball which can
then be sent to support.</p></div>
<div class="paragraph"><p>Leave out subcommand to see the current session.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>session [{save|load|delete} &lt;name&gt; | pack [&lt;name&gt;] | update | list]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>session save bnc966622
session load rsclost-2
session list</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_setnodes"><span class="monospaced">setnodes</span></h4>
<div class="paragraph"><p>In case the host this program runs on is not part of the cluster,
it is necessary to set the list of nodes.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>setnodes node &lt;node&gt; [&lt;node&gt; ...]</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>setnodes node_a node_b</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_show"><span class="monospaced">show</span></h4>
<div class="paragraph"><p>Every transition is saved as a PE file. Use this command to
render that PE file either as configuration or status. The
configuration output is the same as <span class="monospaced">crm configure show</span>.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show &lt;pe&gt; [status]

pe :: &lt;number&gt;|&lt;index&gt;|&lt;file&gt;|live</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>show 2066
show pe-input-2080.bz2 status</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_source"><span class="monospaced">source</span></h4>
<div class="paragraph"><p>Events to be examined can come from the current cluster or from a
<span class="monospaced">hb_report</span> report. This command sets the source. <span class="monospaced">source live</span>
sets source to the running cluster and system logs. If no source
is specified, the current source information is printed.</p></div>
<div class="paragraph"><p>In case a report source is specified as a file reference, the file
is going to be unpacked in place where it resides. This directory
is not removed on exit.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>source [&lt;dir&gt;|&lt;file&gt;|live]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>source live
source /tmp/customer_case_22.tar.bz2
source /tmp/customer_case_22
source</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_transition"><span class="monospaced">transition</span></h4>
<div class="paragraph"><p>This command will print actions planned by the PE and run
graphviz (<span class="monospaced">dotty</span>) to display a graphical representation of the
transition. Of course, for the latter an X11 session is required.
This command invokes <span class="monospaced">ptest(8)</span> in background.</p></div>
<div class="paragraph"><p>The <span class="monospaced">showdot</span> subcommand runs graphviz (<span class="monospaced">dotty</span>) to display a
graphical representation of the <span class="monospaced">.dot</span> file which has been
included in the report. Essentially, it shows the calculation
produced by <span class="monospaced">pengine</span> which is installed on the node where the
report was produced. In optimal case this output should not
differ from the one produced by the locally installed <span class="monospaced">pengine</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">log</span> subcommand shows the full log for the duration of the
transition.</p></div>
<div class="paragraph"><p>A transition can also be saved to a CIB shadow for further
analysis or use with <span class="monospaced">cib</span> or <span class="monospaced">configure</span> commands (use the
<span class="monospaced">save</span> subcommand). The shadow file name defaults to the name of
the PE input file.</p></div>
<div class="paragraph"><p>If the PE input file number is not provided, it defaults to the
last one, i.e. the last transition. The last transition can also
be referenced with number 0. If the number is negative, then the
corresponding transition relative to the last one is chosen.</p></div>
<div class="paragraph"><p>If there are warning and error PE input files or different nodes
were the DC in the observed timeframe, it may happen that PE
input file numbers collide. In that case provide some unique part
of the path to the file.</p></div>
<div class="paragraph"><p>After the <span class="monospaced">ptest</span> output, logs about events that happened during
the transition are printed.</p></div>
<div class="paragraph"><p>The <span class="monospaced">tags</span> subcommand scans the logs for the transition and return a
list of key events during that transition. For example, the tag
<span class="monospaced">error</span> will be returned if there are any errors logged during the
transition.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>transition [&lt;number&gt;|&lt;index&gt;|&lt;file&gt;] [nograph] [v...] [scores] [actions] [utilization]
transition showdot [&lt;number&gt;|&lt;index&gt;|&lt;file&gt;]
transition log [&lt;number&gt;|&lt;index&gt;|&lt;file&gt;]
transition save [&lt;number&gt;|&lt;index&gt;|&lt;file&gt; [name]]
transition tags [&lt;number&gt;|&lt;index&gt;|&lt;file&gt;]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>transition
transition 444
transition -1
transition pe-error-3.bz2
transition node-a/pengine/pe-input-2.bz2
transition showdot 444
transition log
transition save 0 enigma-22</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_transitions"><span class="monospaced">transitions</span></h4>
<div class="paragraph"><p>A transition represents a change in cluster configuration or
state. This command lists the transitions in the current timeframe.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>transitions</pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>transitions</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="cmdhelp_history_wdiff"><span class="monospaced">wdiff</span></h4>
<div class="paragraph"><p>A transition represents a change in cluster configuration or
state. Use <span class="monospaced">wdiff</span> to see what has changed between two
transitions as word differences on a line-by-line basis.</p></div>
<div class="paragraph"><p>If you want to specify the current cluster configuration and
status, use the string <span class="monospaced">live</span>.</p></div>
<div class="paragraph"><p>Normally, the first transition specified should be the one which
is older, but we are not going to enforce that.</p></div>
<div class="paragraph"><p>Note that a single configuration update may result in more than
one transition.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>wdiff &lt;pe&gt; &lt;pe&gt; [status]

pe :: &lt;number&gt;|&lt;index&gt;|&lt;file&gt;|live</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>wdiff 2066 2067
wdiff pe-input-2080.bz2 live status</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="cmdhelp_root_report"><span class="monospaced">report</span></h3>
<div class="paragraph"><p>Interface to a tool for creating a cluster report. A report is an
archive containing log files, configuration files, system information
and other relevant data for a given time period. This is a useful tool
for collecting data to attach to bug reports, or for detecting the
root cause of errors resulting in resource failover, for example.</p></div>
<div class="paragraph"><p>See <span class="monospaced">crmsh_hb_report(8)</span> for more details on arguments,
or call <span class="monospaced">crm report -h</span></p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>report -f {time|"cts:"testnum} [-t time] [-u user] [-l file]
       [-n nodes] [-E files] [-p patt] [-L patt] [-e prog]
       [-MSDZAVsvhd] [dest]</pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>report -f 2pm report_1
report -f "2007/9/5 12:30" -t "2007/9/5 14:00" report_2
report -f 1:00 -t 3:00 -l /var/log/cluster/ha-debug report_3
report -f "09sep07 2:00" -u hbadmin report_4
report -f 18:00 -p "usern.*" -p "admin.*" report_5
report -f cts:133 ctstest_133</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_span_class_monospaced_end_span_span_class_monospaced_cd_span_span_class_monospaced_up_span"><span class="monospaced">end</span> (<span class="monospaced">cd</span>, <span class="monospaced">up</span>)</h3>
<div class="paragraph"><p>The <span class="monospaced">end</span> command ends the current level and the user moves to
the parent level. This command is available everywhere.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>end</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_span_class_monospaced_help_span"><span class="monospaced">help</span></h3>
<div class="paragraph"><p>The <span class="monospaced">help</span> command prints help for the current level or for the
specified topic (command). This command is available everywhere.</p></div>
<div class="paragraph"><p>Usage:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>help [&lt;topic&gt;]</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_span_class_monospaced_quit_span_span_class_monospaced_exit_span_span_class_monospaced_bye_span"><span class="monospaced">quit</span> (<span class="monospaced">exit</span>, <span class="monospaced">bye</span>)</h3>
<div class="paragraph"><p>Leave the program.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bugs">BUGS</h2>
<div class="sectionbody">
<div class="paragraph"><p>Even though all sensible configurations (and most of those that
are not) are going to be supported by the crm shell, I suspect
that it may still happen that certain XML constructs may confuse
the tool. When that happens, please file a bug report.</p></div>
<div class="paragraph"><p>The crm shell will not try to update the objects it does not
understand. Of course, it is always possible to edit such objects
in the XML format.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_authors">AUTHORS</h2>
<div class="sectionbody">
<div class="paragraph"><p>Dejan Muhamedagic, &lt;<a href="mailto:dejan@suse.de">dejan@suse.de</a>&gt;
Kristoffer Gronlund &lt;<a href="mailto:kgronlund@suse.com">kgronlund@suse.com</a>&gt;
and many OTHERS</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph"><p>crm_resource(8), crm_attribute(8), crm_mon(8), cib_shadow(8),
ptest(8), dotty(1), crm_simulate(8), cibadmin(8)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_copying">COPYING</h2>
<div class="sectionbody">
<div class="paragraph"><p>Copyright (C) 2008-2013 Dejan Muhamedagic.
Copyright (C) 2013 Kristoffer Gronlund.</p></div>
<div class="paragraph"><p>Free use of this software is granted under the terms of the GNU General Public License (GPL).</p></div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>

<a href="https://github.com/ClusterLabs/crmsh"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

</body>
</html>
